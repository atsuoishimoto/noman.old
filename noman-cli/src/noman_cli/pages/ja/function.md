# function コマンド概要

`function`は、シェルスクリプトやコマンドラインで関数を定義するためのコマンドです。関数を使うことで、繰り返し使用するコマンドの集まりに名前をつけて再利用できます。

## オプション

`function`コマンド自体にはオプションがありません。関数の定義方法と使用方法に焦点を当てます。

## 定義方法

### **基本的な定義方法**

関数は以下の2つの方法で定義できます。

```bash
# 方法1: functionキーワードを使用
function 関数名() {
    コマンド1
    コマンド2
}

# 方法2: functionキーワードなし
関数名() {
    コマンド1
    コマンド2
}
```

### **引数の使用**

関数内では、引数を`$1`, `$2`などで参照できます。

```bash
function greet() {
    echo "こんにちは、$1さん！"
}

# 実行例
$ greet 田中
こんにちは、田中さん！
```

### **戻り値の設定**

関数は`return`で数値を返すことができます（0〜255の範囲）。

```bash
function is_number() {
    if [[ $1 =~ ^[0-9]+$ ]]; then
        return 0  # 成功（数値である）
    else
        return 1  # 失敗（数値でない）
    fi
}
```

## 使用例

### 基本的な関数の定義と呼び出し

```bash
$ function hello() {
>   echo "こんにちは、世界！"
> }

$ hello
こんにちは、世界！
```

### 引数を使った関数

```bash
$ function calc() {
>   echo "計算結果: $(($1 $2 $3))"
> }

$ calc 5 + 3
計算結果: 8

$ calc 10 \* 2
計算結果: 20
```

### 関数の出力を変数に格納

```bash
$ function get_date() {
>   echo $(date +%Y-%m-%d)
> }

$ today=$(get_date)
$ echo $today
2023-11-15
```

## よくある質問

### Q1. 関数とエイリアスの違いは何ですか？
A. エイリアスは単純なコマンド置換ですが、関数はより複雑な処理や引数の処理ができます。関数は複数のコマンドをまとめて実行でき、条件分岐なども含められます。

### Q2. 関数の一覧を表示するには？
A. `declare -f`コマンドで定義されているすべての関数を表示できます。特定の関数の定義を見るには`declare -f 関数名`を使います。

### Q3. 関数を永続的に使えるようにするには？
A. 関数を`.bashrc`や`.zshrc`などのシェル設定ファイルに追加すると、新しいシェルを開くたびに使用できるようになります。

### Q4. 関数を削除するには？
A. `unset -f 関数名`コマンドで関数を削除できます。

## 追加のヒント

- 関数名は一般的なコマンド名と重複しないようにしましょう。既存のコマンドと同じ名前を使うと、予期しない動作の原因になります。
- 関数内で`local`キーワードを使うと、変数のスコープを関数内に限定できます。これにより、グローバル変数との衝突を防げます。

```bash
function count_files() {
    local count=$(ls -1 | wc -l)
    echo "このディレクトリには$count個のファイルがあります"
}
```

- 関数は`.sh`ファイルに記述して`source`コマンドで読み込むことで、複数のスクリプトで再利用できます。

```bash
# utils.shに関数を定義
$ source utils.sh
# 関数が使えるようになる
```