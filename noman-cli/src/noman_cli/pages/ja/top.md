# top コマンド

プロセスに関する情報をリアルタイムで表示・更新します。

## 概要

`top`はリアルタイムのシステム監視プログラムで、プロセスの一覧を継続的に更新して表示します。システムの概要情報と、現在Linuxカーネルによって管理されているプロセスやスレッドのリストを表示します。デフォルトではCPU使用率でソートされ、システムリソースの使用状況を監視し、最もリソースを消費しているプロセスを特定するのに役立ちます。

## オプション

### **-d, --delay**

画面更新の間隔を秒単位で指定します（小数点を含めることも可能）

```console
$ top -d 5
top - 14:22:10 up 3 days,  5:10,  2 users,  load average: 0.15, 0.21, 0.28
Tasks: 213 total,   1 running, 212 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.3 us,  1.2 sy,  0.0 ni, 96.4 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
MiB Mem :  15895.1 total,   7403.2 free,   3265.4 used,   5226.5 buff/cache
MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.  12039.3 avail Mem
...
```

### **-n, --iterations**

終了前の更新回数を指定します

```console
$ top -n 3
[topは3回更新した後に終了する]
```

### **-p, --pid**

指定したプロセスIDのプロセスのみを監視します

```console
$ top -p 1234,5678
[PID 1234と5678のプロセスのみを表示]
```

### **-u, --user**

指定したユーザーが所有するプロセスのみを表示します

```console
$ top -u username
[usernameが所有するプロセスのみを表示]
```

### **-b, --batch**

バッチモードで実行します（他のプログラムやファイルに出力を送る場合に便利）

```console
$ top -b -n 1 > top_output.txt
[topの出力を1回分top_output.txtに保存する]
```

## 使用例

### 基本的な使用法

```console
$ top
top - 14:22:10 up 3 days,  5:10,  2 users,  load average: 0.15, 0.21, 0.28
Tasks: 213 total,   1 running, 212 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.3 us,  1.2 sy,  0.0 ni, 96.4 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
MiB Mem :  15895.1 total,   7403.2 free,   3265.4 used,   5226.5 buff/cache
MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.  12039.3 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
 1234 user      20   0 3256892 125232  42348 S   2.0   0.8   5:23.02 firefox
 5678 user      20   0  723964  56892  38212 S   1.3   0.4   2:42.15 terminal
```

### 特定のプロセスを高速更新レートで監視

```console
$ top -d 0.5 -p 1234,5678
[プロセス1234と5678のみを表示し、0.5秒ごとに更新]
```

## インタラクティブコマンド

`top`実行中に以下のキーボードコマンドを使用できます：

- **h または ?**: ヘルプを表示
- **q**: プログラムを終了
- **k**: プロセスを終了（PIDの入力を求められる）
- **r**: プロセスの優先度を変更
- **f**: 表示するフィールドを選択
- **o**: ソートフィールドを変更
- **1**: 個々のCPUコアの表示を切り替え
- **m**: メモリ表示モードを切り替え
- **t**: タスク/CPU表示モードを切り替え
- **c**: コマンドライン/プログラム名表示を切り替え
- **M**: メモリ使用量でソート
- **P**: CPU使用率でソート（デフォルト）
- **T**: 時間/累積時間でソート

## ヒント:

### リソースを大量に消費するプロセスの特定

`P`キーを押してCPU使用率でソート、または`M`キーを押してメモリ使用率でソートすると、最もリソースを消費しているプロセスをすぐに特定できます。

### 出力をファイルに保存

バッチモードと`-b`オプションを使用して、後で分析するために出力をファイルに保存できます：
```console
$ top -b -n 1 > system_snapshot.txt
```

### 表示のカスタマイズ

top実行中に`f`キーを押すと、表示する列を選択でき、最も重要な指標に集中できます。

### 複数のCPUを監視

`1`キーを押すと、合計平均ではなく個々のCPUコアの使用率が表示されます。これは、プロセスが単一のコアを最大限に使用しているかどうかを識別するのに役立ちます。

## よくある質問

#### Q1. topを終了するにはどうすればよいですか？
A. `q`キーを押すとプログラムを終了できます。

#### Q2. top内からプロセスを終了するにはどうすればよいですか？
A. `k`キーを押し、終了したいプロセスのPIDを入力し、その後シグナル番号（SIGKILLの場合は9）を入力します。

#### Q3. 更新間隔を変更するにはどうすればよいですか？
A. `-d`オプションの後に秒数を指定します（例：`top -d 3`で3秒ごとに更新）、または実行中に`d`キーを押して新しい遅延時間を入力します。

#### Q4. 特定のユーザーのプロセスだけを表示するにはどうすればよいですか？
A. `top -u ユーザー名`を使用するか、実行中に`u`キーを押してユーザー名を入力します。

#### Q5. ロードアベレージの数値は何を意味していますか？
A. 3つの数値は、過去1分、5分、15分のシステム負荷平均を表します。CPUコア数より低い値は、一般的にシステムが過負荷でないことを示します。

## macOSでの注意点

macOSでの`top`コマンドは、Linuxとは異なるオプションと出力形式を持っています。主な違いは以下の通りです：

- `-o`オプションはソートフィールドを指定するために使用されます（例：`top -o cpu`）
- メモリは異なる単位で表示されます
- 一部のインタラクティブコマンドが異なります
- macOSで利用可能な特定のオプションを確認するには`man top`を使用してください

## 参考資料

https://man7.org/linux/man-pages/man1/top.1.html

## 改訂履歴

- 2025/05/04 初回改訂