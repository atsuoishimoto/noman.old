# xargs コマンド

標準入力からコマンドラインを構築し、他のコマンドを実行します。

## 概要

`xargs` は標準入力から受け取ったテキストを引数として別のコマンドに渡すユーティリティです。パイプラインで前のコマンドの出力を次のコマンドの入力引数として使用したい場合に特に便利です。引数の数が多すぎる場合や、コマンドが標準入力からの直接入力しか受け付けない場合に問題を解決します。

## オプション

### **-0, --null**

入力項目が NULL 文字（\0）で区切られていると解釈します。ファイル名に空白やその他の特殊文字が含まれる場合に便利です。

```console
$ find . -type f -name "*.txt" -print0 | xargs -0 grep "検索語"
./ファイル 1.txt:この中に検索語があります
./メモ.txt:検索語についての注意点
```

### **-I, --replace[=R]**

置換文字列を指定します。入力の各行がこの文字列に置き換えられます。デフォルトは `{}` です。

```console
$ echo "file1.txt file2.txt" | xargs -I {} cp {} backup/
# file1.txtとfile2.txtがbackupディレクトリにコピーされる
```

### **-n, --max-args=MAX-ARGS**

一度に実行するコマンドに渡す最大引数数を指定します。

```console
$ echo "1 2 3 4" | xargs -n 2 echo
1 2
3 4
```

### **-P, --max-procs=MAX-PROCS**

同時に実行するプロセスの最大数を指定します。並列処理に便利です。

```console
$ find . -name "*.jpg" | xargs -P 4 -I {} convert {} {}.png
# 4つの変換プロセスが同時に実行される
```

### **-t, --verbose**

実行する前にコマンドを表示します。

```console
$ echo "file1.txt file2.txt" | xargs -t rm
rm file1.txt file2.txt
```

## 使用例

### ファイル検索と処理の組み合わせ

```console
$ find . -name "*.log" | xargs rm
# カレントディレクトリとサブディレクトリから全ての.logファイルを削除する
```

### 複数ファイルの内容検索

```console
$ find . -name "*.txt" | xargs grep "重要"
./メモ.txt:これは重要な情報です
./計画.txt:重要な締め切り: 5月1日
```

### ファイル名に空白を含むファイルの処理

```console
$ find . -type f -name "*.jpg" -print0 | xargs -0 -I {} mv {} processed/
# 空白を含むファイル名も正しく処理される
```

## ヒント:

### 安全に実行する

`xargs -p` を使用すると、各コマンドを実行する前に確認を求められます。大量のファイルを削除するなど、危険な操作を行う前に便利です。

### 並列処理で時間を節約

`xargs -P` で並列処理を行うと、大量のファイル処理が必要な場合に処理時間を大幅に短縮できます。CPUコア数に合わせて設定するとよいでしょう。

### find コマンドとの組み合わせ

`find` と `xargs` を組み合わせる場合は、ファイル名に空白がある場合に備えて `-print0` と `-0` オプションを使用することをお勧めします。

## よくある質問

#### Q1. `xargs` と直接パイプ（|）の違いは何ですか？
A. 通常のパイプは標準出力を次のコマンドの標準入力に渡しますが、`xargs` は標準入力を次のコマンドの引数として渡します。多くのコマンドは標準入力ではなく引数としてファイル名を受け取るため、この違いは重要です。

#### Q2. ファイル名に空白がある場合、どうすれば安全に処理できますか？
A. `find` コマンドの `-print0` オプションと `xargs` の `-0` オプションを組み合わせて使用します。これにより、ファイル名がNULL文字で区切られ、空白を含むファイル名も正しく処理されます。

#### Q3. 実行されるコマンドを確認するにはどうすればよいですか？
A. `xargs -t` オプションを使用すると、実行される各コマンドが表示されます。これはデバッグや確認に便利です。

#### Q4. 特定の数の引数ごとにコマンドを実行するにはどうすればよいですか？
A. `xargs -n` オプションを使用します。例えば、`xargs -n 2` は2つの引数ごとにコマンドを実行します。

## 参考

https://www.gnu.org/software/findutils/manual/html_node/find_html/xargs-options.html

## Revisions

- 2025/04/30 初版作成