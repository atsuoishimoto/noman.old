# passwd コマンド

ユーザーパスワードを変更します。

## 概要

`passwd` コマンドは、ユーザーが自分自身のパスワードを変更したり、システム管理者が他のユーザーのパスワードを変更または管理したりするためのコマンドです。このコマンドは、ユーザーアカウント情報と暗号化されたパスワードを保存する `/etc/passwd` および `/etc/shadow` ファイルを修正します。

## オプション

### **-d, --delete**

ユーザーのパスワードを削除します（空にします）

```console
$ sudo passwd -d ユーザー名
passwd: パスワード有効期限情報が変更されました。
```

### **-e, --expire**

パスワードを即時に期限切れにし、次回ログイン時にユーザーにパスワード変更を強制します

```console
$ sudo passwd -e ユーザー名
passwd: パスワード有効期限情報が変更されました。
```

### **-l, --lock**

パスワードの先頭に「!」文字を追加してアカウントをロックし、アカウントを無効化します

```console
$ sudo passwd -l ユーザー名
passwd: パスワード有効期限情報が変更されました。
```

### **-u, --unlock**

パスワードから「!」文字を削除して、以前にロックされたアカウントのロックを解除します

```console
$ sudo passwd -u ユーザー名
passwd: パスワード有効期限情報が変更されました。
```

### **-S, --status**

ユーザーのアカウントステータス情報を表示します

```console
$ passwd -S ユーザー名
ユーザー名 PS 2025-05-04 0 99999 7 -1
```

## 使用例

### 自分自身のパスワードを変更する

```console
$ passwd
user1 のパスワードを変更。
現在のパスワード: 
新しいパスワード: 
新しいパスワードを再入力してください: 
passwd: すべての認証トークンが正常に更新されました。
```

### 他のユーザーのパスワードを変更する（root権限で）

```console
$ sudo passwd ユーザー名
新しいパスワード: 
新しいパスワードを再入力してください: 
passwd: すべての認証トークンが正常に更新されました。
```

### ユーザーのパスワードステータスを確認する

```console
$ sudo passwd -S ユーザー名
ユーザー名 PS 2025-05-04 0 99999 7 -1
```

## ヒント:

### パスワードステータス出力の理解

`passwd -S` を使用すると、出力形式は `ユーザー名 パスワード状態 変更日 最小日数 最大日数 警告日数 無効日数 有効期限日` となります。パスワード状態フィールドは、PS（使用可能なパスワード）、LK（ロックされたパスワード）、またはNP（パスワードなし）のいずれかです。

### 安全なパスワードの実践

パスワードを作成する際は、大文字、小文字、数字、特殊文字を組み合わせて使用しましょう。システム設定によっては、パスワードの複雑さの要件が強制される場合があります。

### パスワードファイルの場所

暗号化されたパスワードは `/etc/shadow` に保存され、rootユーザーのみが読み取り可能です。これにより、世界中から読み取り可能な `/etc/passwd` ファイルにハッシュ化されたパスワードを保存する古い方法よりも優れたセキュリティが提供されます。

## よくある質問

#### Q1. 自分のパスワードを変更するにはどうすればよいですか？
A. オプションなしで単に `passwd` と入力し、現在のパスワードを入力してから、新しいパスワードを2回入力するプロンプトに従ってください。

#### Q2. システムが新しいパスワードを拒否するのはなぜですか？
A. ほとんどのシステムにはパスワードの複雑さの要件があります。パスワードが短すぎる、単純すぎる、辞書の単語に基づいている、または以前のパスワードから多くの文字を再利用している場合、拒否される可能性があります。

#### Q3. ユーザーに次回ログイン時にパスワードを変更させるにはどうすればよいですか？
A. `sudo passwd -e ユーザー名` を使用してユーザーのパスワードを期限切れにし、次回ログイン時にパスワードを変更するよう強制します。

#### Q4. アカウントをロックすることとパスワードを削除することの違いは何ですか？
A. アカウントをロックする（`passwd -l`）と、パスワードハッシュを保持したままログインを防止します。パスワードを削除する（`passwd -d`）と、パスワードが完全に削除され、システム設定によってはパスワードなしでのログインが許可される場合があります。

## 参考文献

https://man7.org/linux/man-pages/man1/passwd.1.html

## 改訂履歴

- 2025/05/04 初回改訂