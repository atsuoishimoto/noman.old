# shift コマンド

シェルスクリプト内の位置パラメータをシフトし、最初のパラメータを削除して他のすべてのパラメータを1つ下の位置に移動します。

## 概要

`shift`コマンドはシェル組み込みコマンドで、シェルスクリプト内の位置パラメータ（$1、$2など）を調整します。デフォルトでは、最初のパラメータ（$1）を削除し、残りのすべてのパラメータを1つ下の位置にシフトします（$2が$1に、$3が$2になるなど）。スクリプト内でコマンドライン引数を順番に処理する際によく使用されます。

## オプション

### **-n N**（Bashのみ）

位置パラメータを1つではなくN個の位置だけシフトします。

```console
$ set -- a b c d e
$ echo $1 $2 $3
a b c
$ shift 2
$ echo $1 $2 $3
c d e
```

注意：`shift`コマンドのオプションは非常に少なく、その主な目的はシンプルです。

## 使用例

### スクリプト内での基本的な使用法

```console
$ cat shift_example.sh
#!/bin/bash
echo "引数の総数: $#"
echo "最初の引数: $1"
shift
echo "シフト後の最初の引数: $1"
echo "シフト後の引数の総数: $#"

$ ./shift_example.sh apple banana cherry
引数の総数: 3
最初の引数: apple
シフト後の最初の引数: banana
シフト後の引数の総数: 2
```

### ループ内ですべての引数を処理する

```console
$ cat process_args.sh
#!/bin/bash
while [ $# -gt 0 ]; do
    echo "処理中: $1"
    shift
done

$ ./process_args.sh one two three
処理中: one
処理中: two
処理中: three
```

### 数値を指定したshift（Bash）

```console
$ cat shift_multiple.sh
#!/bin/bash
echo "元の引数: $@"
echo "数: $#"
shift 2
echo "shift 2後: $@"
echo "数: $#"

$ ./shift_multiple.sh a b c d e
元の引数: a b c d e
数: 5
shift 2後: c d e
数: 3
```

## ヒント:

### 残りの引数を確認する

特に`shift n`を使用する場合は、シフトする前に十分な引数が残っているかを常に確認してください。引数の数よりも多くの位置をシフトしようとすると、シェルによってはエラーが発生します。

```console
$ cat safe_shift.sh
#!/bin/bash
if [ $# -ge 2 ]; then
    shift 2
else
    echo "2つの位置をシフトするのに十分な引数がありません"
fi
```

### getoptsと組み合わせる

オプションと引数の両方を処理する場合は、まず`getopts`でオプションを処理し、その後`shift`を使用して残りの引数を処理します。

### $0は変更されないことを覚えておく

`shift`コマンドは位置パラメータ（$1、$2など）にのみ影響します。スクリプト名（$0）は変更されません。

## よくある質問

#### Q1. 引数が残っていない場合に shift を使用するとどうなりますか？
A. ほとんどのシェルでは、引数が残っていない状態で`shift`を使用してもエラーは発生しませんが、n個未満の引数しか残っていない状態で`shift n`を使用すると、シェルによってはエラーが発生する場合があります。

#### Q2. shift は $@ と $* 変数に影響しますか？
A. はい、$@と$*の両方がシフト後の新しい位置パラメータのセットを反映するように更新されます。

#### Q3. 対話型シェルセッションでshiftを使用できますか？
A. はい、使用できますが、主にスクリプトで役立ちます。対話型セッションでは、まず`set -- arg1 arg2`を使用して位置パラメータを設定できます。

#### Q4. シフト後に残っている引数の数をどうやって知ることができますか？
A. $#変数を使用します。これは常に現在の位置パラメータの数を含んでいます。

## 参考資料

`shift`コマンドはシェル組み込みコマンドで、Bashマニュアルに記載されています：
https://www.gnu.org/software/bash/manual/html_node/Bourne-Shell-Builtins.html#index-shift

## 改訂履歴

- 2025/05/04 初版作成