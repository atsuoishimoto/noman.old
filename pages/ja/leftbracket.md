# [ コマンド

条件式を評価するためのテストコマンドです。

## 概要

`[`（左角括弧）コマンドは、`test`コマンドの別名で、ファイルの種類やプロパティの確認、文字列や数値の比較などの条件テストを行います。シェルスクリプトで条件分岐を実装する際によく使用されます。`[`コマンドを使用する場合は、必ず閉じ括弧 `]` で終わる必要があります。

## オプション

`[` コマンド自体にはオプションはありませんが、さまざまな条件式を評価するための演算子があります。

### **ファイルテスト**

ファイルの存在や種類、属性をテストします。

```console
$ [ -f /etc/passwd ] && echo "ファイルが存在します"
ファイルが存在します

$ [ -d /etc ] && echo "ディレクトリが存在します"
ディレクトリが存在します
```

### **文字列テスト**

文字列の比較や空文字列のチェックを行います。

```console
$ [ "apple" = "apple" ] && echo "文字列は等しいです"
文字列は等しいです

$ name="John"
$ [ -n "$name" ] && echo "変数nameは空ではありません"
変数nameは空ではありません
```

### **数値比較**

数値の大小関係を比較します。

```console
$ [ 10 -gt 5 ] && echo "10は5より大きいです"
10は5より大きいです

$ [ 7 -eq 7 ] && echo "7は7と等しいです"
7は7と等しいです
```

### **論理演算子**

複数の条件を組み合わせるための論理演算子です。

```console
$ [ -f /etc/passwd -a -r /etc/passwd ] && echo "ファイルが存在し、読み取り可能です"
ファイルが存在し、読み取り可能です

$ [ -d /nonexistent -o -d /etc ] && echo "少なくとも1つのディレクトリが存在します"
少なくとも1つのディレクトリが存在します
```

## 使用例

### if文での使用

```console
$ if [ -f /etc/hosts ]; then
>   echo "hostsファイルが存在します"
> else
>   echo "hostsファイルが見つかりません"
> fi
hostsファイルが存在します
```

### while文での使用

```console
$ count=1
$ while [ $count -le 3 ]; do
>   echo "カウント: $count"
>   count=$((count + 1))
> done
カウント: 1
カウント: 2
カウント: 3
```

## ヒント:

### 変数の引用符で囲む

変数を使用する際は、常に二重引用符で囲むことをお勧めします。これにより、変数が空の場合や空白を含む場合のエラーを防ぐことができます。

```console
$ filename=""
$ [ -f $filename ] # エラーになる可能性あり
bash: [: -f: unary operator expected
$ [ -f "$filename" ] # 安全
```

### 新しいスタイルの条件式

Bashでは、`[[` と `]]` を使用する新しい条件式構文も利用できます。これはより柔軟で、エラーが少なくなります。

```console
$ [[ "hello world" == hello* ]] && echo "パターンマッチが機能します"
パターンマッチが機能します
```

### 数値計算には (( )) を使用

数値計算や比較には `(( ))` を使用すると、より自然な数学記法が使えます。

```console
$ (( 10 > 5 )) && echo "10は5より大きいです"
10は5より大きいです
```

## よくある質問

#### Q1. `[` と `test` コマンドの違いは何ですか？
A. 機能的には同じです。`[` は `test` の別名で、構文的に条件式を括弧で囲むように見せるために使われます。`[` を使う場合は必ず閉じ括弧 `]` が必要です。

#### Q2. `[` と `[[` の違いは何ですか？
A. `[[` はBashなどの新しいシェルの拡張機能で、パターンマッチングや論理演算子の使用が簡単になります。`[` はPOSIX準拠のシェルスクリプトで広く互換性があります。

#### Q3. ファイルが存在するかどうかを確認するにはどうすればよいですか？
A. `[ -e ファイル名 ]` を使用します。特定のタイプを確認するには、`-f`（通常ファイル）や`-d`（ディレクトリ）などのオプションを使用します。

#### Q4. 文字列が空かどうかを確認するにはどうすればよいですか？
A. `[ -z "$変数" ]` を使用すると、文字列が空かどうかを確認できます。逆に、空でないことを確認するには `[ -n "$変数" ]` を使用します。

## 参考資料

https://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html

## 改訂履歴

- 2025/04/30 初版作成