<!DOCTYPE html>
<html lang="en">
  <head>
    
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      
        <link rel="stylesheet" href="/css/reset.css" />
        <link rel="stylesheet" href="/css/main.css" />
        <link rel="stylesheet" href="/css/search.css" />
      

      
        <script src="/en/summary.js"></script>
        <script src="/js/search.js"></script>
        <script src="/js/language-switcher.js"></script>
      
      <title>
        
  perf - noman

      </title>

      

      
    
  </head>
  <body>
    
  <nav>
    <div class="nav-logo">
      <a href="/"><img src="../../../images/white.png" height="50px" /></a>
    </div>
    <div class="nav-right">
      <div class="nav-search">
        <input id="nav-searchbox" type="text" placeholder="Search command..." />
      </div>
      <div class="nav-links">
        <a href="/en/commandlist.html">Commands</a>
        <span id="language-switcher"></span>
      </div>
    </div>
  </nav>

  <div class="content">
    <main>
      
  <h1>perf command</h1>
<p>Performance analysis tool for Linux, providing hardware counter statistics and tracing capabilities.</p>
<h2>Overview</h2>
<p><code>perf</code> is a powerful Linux profiling and performance analysis tool that accesses the performance monitoring hardware counters of the CPU to gather statistics about program execution. It can monitor CPU performance events, trace system calls, and analyze application performance with minimal overhead. Part of the Linux kernel tools, <code>perf</code> helps developers identify bottlenecks and optimize code.</p>
<h2>Options</h2>
<h3><strong>-e, --event</strong></h3>
<p>Specify the performance event to count or sample</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>stat<span style="color: #F8F8F8"> </span>-e<span style="color: #F8F8F8"> </span>cycles,instructions<span style="color: #F8F8F8"> </span>./myprogram
<span style="color: #000; font-style: italic"> Performance counter stats for &#39;./myprogram&#39;:</span>

<span style="color: #000; font-style: italic">       1,234,567      cycles</span>
<span style="color: #000; font-style: italic">       2,345,678      instructions             #    1.90  insn per cycle</span>
<span style="color: #000; font-style: italic">       </span>
<span style="color: #000; font-style: italic">       0.123456789 seconds time elapsed</span>
</pre></div>
<h3><strong>-p, --pid</strong></h3>
<p>Profile events on existing process by process ID</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>record<span style="color: #F8F8F8"> </span>-p<span style="color: #F8F8F8"> </span><span style="color: #0000CF; font-weight: bold">1234</span><span style="color: #F8F8F8"> </span>-g
<span style="color: #000; font-style: italic">[ perf record: Woken up 1 times to write data ]</span>
<span style="color: #000; font-style: italic">[ perf record: Captured and wrote 0.452 MB perf.data (5093 samples) ]</span>
</pre></div>
<h3><strong>-a, --all-cpus</strong></h3>
<p>System-wide monitoring of all CPUs</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>stat<span style="color: #F8F8F8"> </span>-a<span style="color: #F8F8F8"> </span>sleep<span style="color: #F8F8F8"> </span><span style="color: #0000CF; font-weight: bold">5</span>
<span style="color: #000; font-style: italic"> Performance counter stats for &#39;system wide&#39;:</span>

<span style="color: #000; font-style: italic">       12,345,678      cpu-cycles           </span>
<span style="color: #000; font-style: italic">        5,678,901      instructions              #    0.46  insn per cycle</span>
<span style="color: #000; font-style: italic">          123,456      cache-misses</span>

<span style="color: #000; font-style: italic">       5.000621884 seconds time elapsed</span>
</pre></div>
<h3><strong>-g, --call-graph</strong></h3>
<p>Enable call-graph (stack chain/backtrace) recording</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>record<span style="color: #F8F8F8"> </span>-g<span style="color: #F8F8F8"> </span>./myprogram
<span style="color: #000; font-style: italic">[ perf record: Woken up 1 times to write data ]</span>
<span style="color: #000; font-style: italic">[ perf record: Captured and wrote 0.452 MB perf.data (5093 samples) ]</span>
</pre></div>
<h2>Usage Examples</h2>
<h3>Basic CPU statistics</h3>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>stat<span style="color: #F8F8F8"> </span>./myprogram
<span style="color: #000; font-style: italic"> Performance counter stats for &#39;./myprogram&#39;:</span>

<span style="color: #000; font-style: italic">          0.086283      task-clock (msec)         #    0.733 CPUs utilized</span>
<span style="color: #000; font-style: italic">                 2      context-switches          #    0.023 M/sec</span>
<span style="color: #000; font-style: italic">                 0      cpu-migrations            #    0.000 K/sec</span>
<span style="color: #000; font-style: italic">               108      page-faults               #    0.001 M/sec</span>
<span style="color: #000; font-style: italic">           235,538      cycles                    #    2.731 GHz</span>
<span style="color: #000; font-style: italic">           580,716      instructions              #    2.47  insn per cycle</span>
<span style="color: #000; font-style: italic">           116,931      branches                  #    1.356 M/sec</span>
<span style="color: #000; font-style: italic">             3,468      branch-misses             #    2.97% of all branches</span>

<span style="color: #000; font-style: italic">       0.117743392 seconds time elapsed</span>
</pre></div>
<h3>Recording and analyzing performance data</h3>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>record<span style="color: #F8F8F8"> </span>-g<span style="color: #F8F8F8"> </span>./myprogram
<span style="color: #000; font-style: italic">[ perf record: Woken up 1 times to write data ]</span>
<span style="color: #000; font-style: italic">[ perf record: Captured and wrote 0.452 MB perf.data (5093 samples) ]</span>

<span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>report
<span style="color: #8F5902"># </span>Samples:<span style="color: #F8F8F8"> </span>5K<span style="color: #F8F8F8"> </span>of<span style="color: #F8F8F8"> </span>event<span style="color: #F8F8F8"> </span><span style="color: #4E9A06">&#39;cycles&#39;</span>
<span style="color: #8F5902"># </span>Event<span style="color: #F8F8F8"> </span>count<span style="color: #F8F8F8"> </span><span style="color: #CE5C00; font-weight: bold">(</span>approx.<span style="color: #CE5C00; font-weight: bold">)</span>:<span style="color: #F8F8F8"> </span><span style="color: #0000CF; font-weight: bold">2345678901</span>
<span style="color: #8F5902">#</span>
<span style="color: #8F5902"># </span>Overhead<span style="color: #F8F8F8">  </span>Command<span style="color: #F8F8F8">      </span>Shared<span style="color: #F8F8F8"> </span>Object<span style="color: #F8F8F8">        </span>Symbol
<span style="color: #8F5902"># </span>........<span style="color: #F8F8F8">  </span>.......<span style="color: #F8F8F8">  </span>.................<span style="color: #F8F8F8">  </span>..............
<span style="color: #8F5902">#</span>
<span style="color: #000; font-style: italic">    14.59%  myprogram  myprogram           [.] process_data</span>
<span style="color: #000; font-style: italic">    10.21%  myprogram  myprogram           [.] calculate_result</span>
<span style="color: #000; font-style: italic">     8.45%  myprogram  libc-2.31.so        [.] malloc</span>
</pre></div>
<h3>Tracing system calls</h3>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>trace<span style="color: #F8F8F8"> </span>-p<span style="color: #F8F8F8"> </span><span style="color: #0000CF; font-weight: bold">1234</span>
<span style="color: #000; font-style: italic">     0.000 ( 0.000 ms): myprogram/1234 write(fd: 1, buf: 0x7f9876543210, count: 16) = 16</span>
<span style="color: #000; font-style: italic">     0.223 ( 0.019 ms): myprogram/1234 read(fd: 0, buf: 0x7f9876543210, count: 1024) = 64</span>
<span style="color: #000; font-style: italic">     0.415 ( 0.021 ms): myprogram/1234 open(filename: 0x7f9876543210, flags: RDONLY) = 3</span>
</pre></div>
<h2>Tips</h2>
<h3>Use Flame Graphs for Visualization</h3>
<p>Convert perf data to flame graphs using tools like FlameGraph to visualize call stacks and quickly identify hot spots in your code.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>record<span style="color: #F8F8F8"> </span>-g<span style="color: #F8F8F8"> </span>-F<span style="color: #F8F8F8"> </span><span style="color: #0000CF; font-weight: bold">99</span><span style="color: #F8F8F8"> </span>./myprogram
<span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>script<span style="color: #F8F8F8"> </span><span style="color: #000; font-weight: bold">|</span><span style="color: #F8F8F8"> </span>./FlameGraph/stackcollapse-perf.pl<span style="color: #F8F8F8"> </span><span style="color: #000; font-weight: bold">|</span><span style="color: #F8F8F8"> </span>./FlameGraph/flamegraph.pl<span style="color: #F8F8F8"> </span>&gt;<span style="color: #F8F8F8"> </span>profile.svg
</pre></div>
<h3>Focus on Specific Events</h3>
<p>Instead of collecting all events, focus on specific ones like cache-misses or branch-misses to diagnose particular performance issues.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>stat<span style="color: #F8F8F8"> </span>-e<span style="color: #F8F8F8"> </span>cache-misses,branch-misses<span style="color: #F8F8F8"> </span>./myprogram
</pre></div>
<h3>Reduce Overhead with Sampling</h3>
<p>For production environments, use sampling to reduce overhead by specifying a frequency:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #8F5902">$ </span>perf<span style="color: #F8F8F8"> </span>record<span style="color: #F8F8F8"> </span>-F<span style="color: #F8F8F8"> </span><span style="color: #0000CF; font-weight: bold">99</span><span style="color: #F8F8F8"> </span>-g<span style="color: #F8F8F8"> </span>./myprogram
</pre></div>
<h2>Frequently Asked Questions</h2>
<h4>Q1. What's the difference between <code>perf stat</code> and <code>perf record</code>?</h4>
<p>A. <code>perf stat</code> provides a summary of performance counters, while <code>perf record</code> captures detailed samples for later analysis with <code>perf report</code>.</p>
<h4>Q2. How do I profile a running application?</h4>
<p>A. Use <code>perf record -p PID</code> where PID is the process ID of your running application.</p>
<h4>Q3. Can I use perf on a virtual machine?</h4>
<p>A. Yes, but with limitations. Some hardware counters may not be available or accurate in virtualized environments.</p>
<h4>Q4. How do I see which functions are using the most CPU?</h4>
<p>A. Use <code>perf top</code> for real-time function monitoring or <code>perf record</code> followed by <code>perf report</code> for detailed analysis.</p>
<h4>Q5. Does perf work on all Linux distributions?</h4>
<p>A. Most modern distributions support perf, but functionality may vary based on kernel version and configuration.</p>
<h2>References</h2>
<p>https://perf.wiki.kernel.org/index.php/Main_Page</p>
<h2>Revisions</h2>
<ul>
<li>2025/05/04 First revision</li>
</ul>


    </main>
  </div>

  <footer>
    <p>
      Copyright © 2025 noman project | <a href="https://github.com/atsuoishimoto/noman">GitHub</a> | MIT License
    </p>
  </footer>

  </body>
</html>