# source コマンド

現在のシェル環境内でファイルやスクリプトからコマンドを実行します。

## 概要

`source` コマンド（別名 `.` コマンド）は、指定されたファイルからコマンドを読み込み、現在のシェル環境で実行します。スクリプトを直接実行すると新しいシェルプロセスが作成されますが、`source` は現在のシェルでコマンドを実行するため、読み込まれたファイル内で定義された環境変数や関数が現在のセッションで持続します。

## オプション

`source` コマンドはシェル組み込みコマンドであるため、オプションはほとんどありません。

### **-h (--help)**

`source` コマンドに関するヘルプ情報を表示します。

```console
$ source --help
source: source filename [arguments]
    現在のシェルでファイルからコマンドを実行します。
    
    FILENAMEからコマンドを読み込み、現在のシェルで実行します。
    FILENAMEを含むディレクトリを見つけるために$PATHのエントリが使用されます。
    引数が指定された場合、FILENAMEが実行されるときに位置パラメータになります。
    
    終了ステータス:
    FILENAMEで実行された最後のコマンドのステータスを返します。
    FILENAMEが読み込めない場合は失敗します。
```

## 使用例

### 設定ファイルの読み込み

```console
$ source ~/.bashrc
```

これにより、新しいターミナルセッションを開始せずにbash設定を再読み込みできます。

### 変数を含むスクリプトの読み込み

```console
$ cat setup_env.sh
#!/bin/bash
export PROJECT_ROOT="/home/user/projects"
export DEBUG_MODE="true"

$ source setup_env.sh
$ echo $PROJECT_ROOT
/home/user/projects
```

### 読み込むファイルに引数を渡す

```console
$ cat greet.sh
echo "Hello, $1!"

$ source greet.sh World
Hello, World!
```

## ヒント:

### 仮想環境のアクティベートに source を使用する

Pythonを使用する場合、仮想環境をアクティベートするために `source` を使用できます：

```console
$ source venv/bin/activate
(venv) $
```

### ドットコマンドを代替として使用する

`.` コマンドは `source` の短い代替であり、同じように機能します：

```console
$ . ~/.bashrc
```

### 読み込む前にファイルの存在を確認する

エラーを避けるために、ファイルを読み込む前に存在するか確認しましょう：

```console
$ [ -f ~/.env_vars ] && source ~/.env_vars
```

## よくある質問

#### Q1. `source` とスクリプトを直接実行することの違いは何ですか？
A. スクリプトを `source` すると、現在のシェル環境で実行され、変数や関数が持続します。スクリプトを直接実行する場合（例：`./script.sh`）、新しいサブシェルで実行され、定義された変数や関数はスクリプトが完了すると失われます。

#### Q2. `source` はどのタイプのファイルでも使用できますか？
A. `source` はシェルスクリプトファイルで動作するように設計されています。コマンドラインで入力したかのようにファイル内のコマンドを読み込んで実行します。通常、bash、zsh、または他のシェルスクリプトファイルで使用されます。

#### Q3. `source` はすべてのシェルで同じように動作しますか？
A. 基本的な機能はシェル間で似ていますが、微妙な違いがある場合があります。bashとzshでは `source` と `.` の両方が機能しますが、shのような一部のシェルでは `.` コマンドのみをサポートしています。

#### Q4. 読み込んだファイルをデバッグするにはどうすればよいですか？
A. ファイルの先頭に `set -x` を追加してデバッグモードを有効にすると、各コマンドが実行される前に表示されます。

## 参考資料

Bashマニュアル: https://www.gnu.org/software/bash/manual/bash.html

## 改訂履歴

- 2025/05/04 初回改訂