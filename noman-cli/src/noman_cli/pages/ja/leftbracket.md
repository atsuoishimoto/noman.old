# [ コマンド

条件式を評価し、評価結果に基づいてステータスを返します。

## 概要

`[` コマンド（`test` としても知られる）はシェルの組み込みコマンドで、条件式を評価して 0（真）または 1（偽）のステータスを返します。シェルスクリプトでファイル属性のテスト、文字列比較、算術演算の条件テストによく使用されます。このコマンドは構文を完成させるために閉じる `]` が必要です。

## オプション

### **ファイルテスト**

ファイルのプロパティや属性をテストします

```console
$ [ -f /etc/passwd ] && echo "通常ファイルが存在する"
通常ファイルが存在する
```

### **文字列テスト**

文字列を比較したり、文字列のプロパティをチェックしたりします

```console
$ name="John"
$ [ "$name" = "John" ] && echo "名前が一致します"
名前が一致します
```

### **整数テスト**

整数値を比較します

```console
$ age=25
$ [ $age -gt 18 ] && echo "成人です"
成人です
```

## 使用例

### ファイルが存在するかテストする

```console
$ [ -e /etc/hosts ] && echo "ファイルが存在します" || echo "ファイルが存在しません"
ファイルが存在します
```

### ディレクトリが書き込み可能かチェックする

```console
$ [ -w /tmp ] && echo "ディレクトリは書き込み可能です" || echo "ディレクトリは書き込み不可です"
ディレクトリは書き込み可能です
```

### if文での文字列値の比較

```console
$ fruit="apple"
$ if [ "$fruit" = "apple" ]; then
>   echo "りんごです"
> else
>   echo "りんごではありません"
> fi
りんごです
```

## 一般的なファイルテスト演算子

| 演算子 | 説明 |
|----------|-------------|
| `-e file` | ファイルが存在する場合に真 |
| `-f file` | ファイルが通常ファイルの場合に真 |
| `-d file` | ファイルがディレクトリの場合に真 |
| `-r file` | ファイルが読み取り可能な場合に真 |
| `-w file` | ファイルが書き込み可能な場合に真 |
| `-x file` | ファイルが実行可能な場合に真 |
| `-s file` | ファイルが存在しサイズが0より大きい場合に真 |

## 一般的な文字列テスト演算子

| 演算子 | 説明 |
|----------|-------------|
| `-z string` | 文字列の長さが0の場合に真 |
| `-n string` | 文字列の長さが0でない場合に真 |
| `string1 = string2` | 文字列が等しい場合に真 |
| `string1 != string2` | 文字列が等しくない場合に真 |

## 一般的な整数比較演算子

| 演算子 | 説明 |
|----------|-------------|
| `int1 -eq int2` | 整数が等しい場合に真 |
| `int1 -ne int2` | 整数が等しくない場合に真 |
| `int1 -lt int2` | int1がint2より小さい場合に真 |
| `int1 -le int2` | int1がint2以下の場合に真 |
| `int1 -gt int2` | int1がint2より大きい場合に真 |
| `int1 -ge int2` | int1がint2以上の場合に真 |

## ヒント:

### 変数は常に引用符で囲む
テスト式では変数を常に引用符で囲み、単語分割やグロブの問題を防ぎましょう：
```console
$ [ "$variable" = "value" ]  # 正しい
```

### 可能であれば二重角括弧を使用する
Bashでは、より高度な機能と予期せぬ問題を減らすために、`[` の代わりに `[[` の使用を検討してください：
```console
$ [[ $string =~ ^[0-9]+$ ]] && echo "数値です"
```

### スペースを忘れない
`[` コマンドは開き括弧の後と閉じ括弧の前にスペースが必要です：
```console
$ [ -f file.txt ]  # 正しい
$ [-f file.txt]    # 間違い - 失敗します
```

## よくある質問

#### Q1. `[` と `[[` の違いは何ですか？
A. `[` はすべてのPOSIXシェルで利用可能なコマンド（`test` としても知られる）であり、`[[` はBashやその他の現代的なシェルのシェルキーワードで、パターンマッチングや論理演算子などの拡張機能を提供します。

#### Q2. なぜ括弧の周りにスペースが必要なのですか？
A. `[` は実際にコマンド（`ls` や `grep` のような）なので、引数と区別するためにスペースが必要です。閉じる `]` はその最後の引数です。

#### Q3. 複数の条件をテストするにはどうすればよいですか？
A. `-a`（AND）または `-o`（OR）演算子を使用します：
```console
$ [ -f file.txt -a -r file.txt ] && echo "ファイルが存在し、読み取り可能です"
```
`[[` を使用する場合は、代わりに `&&` と `||` を使用できます。

## 参考文献

https://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html

## 改訂履歴

- 2025/05/04 初版作成