# chsh コマンド

ユーザーのログインシェルを変更します。

## 概要

`chsh`コマンドは、ユーザーがログインシェル（ログイン時に起動するコマンドインタープリタ）を変更できるようにします。このコマンドはパスワードファイル内のユーザーエントリを修正し、システムにログインしたときに実行されるシェルプログラムを設定します。一般ユーザーは自分自身のシェルのみを変更できますが、スーパーユーザー（root）は任意のユーザーのシェルを変更できます。

## オプション

### **-s, --shell シェル**

使用するログインシェルを指定します。指定するシェルは、スーパーユーザーでない限り、/etc/shellsファイルに記載されている必要があります。

```console
$ chsh -s /bin/bash
Password: 
Shell changed.
```

### **-l, --list-shells**

/etc/shellsファイルに記載されているシェルの一覧を表示して終了します。

```console
$ chsh -l
/bin/sh
/bin/bash
/bin/rbash
/bin/dash
/bin/zsh
/usr/bin/zsh
/usr/bin/fish
```

### **-h, --help**

ヘルプメッセージを表示して終了します。

```console
$ chsh --help
Usage: chsh [options] [LOGIN]

Options:
  -h, --help                    display this help message and exit
  -s, --shell SHELL             specify login shell
  -l, --list-shells             print list of shells and exit

For more details see chsh(1).
```

## 使用例

### 自分のシェルをzshに変更する

```console
$ chsh -s /usr/bin/zsh
Password: 
Shell changed.
```

### 他のユーザーのシェルを変更する（root権限が必要）

```console
$ sudo chsh -s /bin/bash ユーザー名
[sudo] password for current_user: 
Shell changed.
```

### 現在のシェルを確認する

```console
$ echo $SHELL
/bin/bash
```

## ヒント:

### 利用可能なシェルを事前に確認する

シェルを変更する前に、必ず`chsh -l`を使用してシステムで利用可能なシェルを確認してください。rootでない限り、`/etc/shells`に記載されているシェルのみをログインシェルとして設定できます。

### シェルの変更は次回ログイン時に反映される

シェルの変更はログアウトして再度ログインするまで反映されません。現在のターミナルセッションは以前のシェルを使用し続けます。

### 互換性のないシェルを設定しない

システムに存在しないシェルや、使い方に慣れていないシェルを設定しないよう注意してください。無効なシェルを設定すると、ログインできなくなる可能性があります。

### 設定ファイルをバックアップする

シェルを変更する前に、シェル固有の設定ファイル（`.bashrc`や`.zshrc`など）をバックアップしておくと、必要に応じて設定を復元できます。

## よくある質問

#### Q1. 現在使用しているシェルを確認するにはどうすればよいですか？
A. `echo $SHELL`を実行すると、現在のログインシェルを確認できます。これは設定されたログインシェルを表示するもので、必ずしも現在のセッションのシェルを示すわけではないことに注意してください。

#### Q2. どんなプログラムでもシェルとして使用できますか？
A. いいえ、セキュリティ上の理由から、スーパーユーザーでない限り、`/etc/shells`ファイルに記載されているシェルのみを使用できます。

#### Q3. 新しいシェルを利用可能なオプションに追加するにはどうすればよいですか？
A. シェルパッケージをインストールし、そのパスを`/etc/shells`に追加します（root権限が必要です）。

#### Q4. 無効なシェルを設定するとどうなりますか？
A. 存在しないか実行できないシェルを設定すると、通常の方法でログインできなくなる可能性があります。リカバリーモードから修正するか、管理者に元に戻してもらう必要があります。

#### Q5. シェルを変更した後、コンピュータを再起動する必要がありますか？
A. いいえ、変更を反映させるには、ログアウトして再度ログインするだけで十分です。

## 参考資料

https://man7.org/linux/man-pages/man1/chsh.1.html

## 改訂履歴

- 2025/05/04 初版作成