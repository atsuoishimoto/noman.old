# set

`set` コマンドはシェル環境の変数や設定を表示・変更するためのコマンドです。主にBashやZshなどのシェルで使用され、シェルの動作を制御します。

## オプション

### **-e**

エラーが発生した時点でスクリプトの実行を中止します。デバッグに役立ちます。

```bash
$ set -e
$ command_that_fails
# コマンドがエラーを返すとスクリプトはここで終了する
```

### **-x**

実行されるコマンドを表示します。デバッグに便利です。

```bash
$ set -x
$ echo "Hello"
+ echo "Hello"
Hello
```

### **-u**

未定義の変数を使用した場合にエラーを発生させます。

```bash
$ set -u
$ echo $UNDEFINED_VARIABLE
bash: UNDEFINED_VARIABLE: 未定義の変数です
```

### **-o pipefail**

パイプラインの中で一つでもコマンドが失敗した場合、パイプライン全体を失敗として扱います。

```bash
$ set -o pipefail
$ false | true
$ echo $?
1  # falseが失敗したため、パイプライン全体が失敗と見なされる
```

### **+オプション**

オプションを無効にします（例：`set +e`でエラー時の中断を無効化）。

```bash
$ set +e
$ command_that_fails
# エラーが発生してもスクリプトは続行される
```

## 使用例

### 現在の設定を表示

```bash
$ set
# 現在のシェル変数と関数の一覧が表示される
BASH_VERSION='5.1.16(1)-release'
HOME=/home/user
PATH=/usr/local/bin:/usr/bin:/bin
...
```

### シェルスクリプトの安全モード

```bash
#!/bin/bash
set -euo pipefail

# エラーが発生したら停止し(-e)
# 未定義変数を使用したらエラー(-u)
# パイプラインの一部が失敗したら全体を失敗とみなす(-o pipefail)

echo "安全なスクリプトの実行"
```

### デバッグモード

```bash
$ set -x
$ for i in {1..3}; do echo $i; done
+ for i in '{1..3}'
+ echo 1
1
+ for i in '{1..3}'
+ echo 2
2
+ for i in '{1..3}'
+ echo 3
3
```

## よくある質問

### Q1. `set` と `export` の違いは何ですか？
A. `set` はシェルの動作や変数を設定するのに対し、`export` は変数を子プロセスに引き継ぐために使用します。

### Q2. シェルスクリプトの先頭によく見る `set -e` とは何ですか？
A. エラーが発生した時点でスクリプトの実行を中止する設定です。これにより、エラーを見逃さずに済みます。

### Q3. `set` コマンドで設定した内容はログアウト後も保持されますか？
A. いいえ、`set` による設定は現在のシェルセッションのみ有効です。永続的に設定するには `.bashrc` や `.zshrc` などの設定ファイルに記述する必要があります。

### Q4. `set -- arg1 arg2` のような使い方は何ですか？
A. シェルの位置パラメータ（`$1`, `$2` など）を設定します。スクリプト内で引数を操作する際に便利です。

## 追加情報

- `set` はシェルによって動作が異なる場合があります。Bash、Zsh、sh などで微妙な違いがあります。
- スクリプトの先頭に `set -euxo pipefail` を記述すると、堅牢なスクリプトを書くのに役立ちます。
- macOSでは基本的に同じように動作しますが、使用しているシェルのバージョンによって利用可能なオプションが異なる場合があります。

## 参考情報

https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html