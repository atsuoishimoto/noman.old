# gdb コマンド

GNU デバッガを使用してソースコードレベルでプログラムをデバッグおよび分析します。

## 概要

GDB（GNU Debugger）は、プログラムの実行を監視および制御できる強力なデバッグツールです。実行を一時停止し、変数を調査し、ブレークポイントを設定し、コードを1行ずつステップ実行し、プログラムのクラッシュを分析することで、バグを見つけて修正するのに役立ちます。GDBはC、C++、Objective-C、Fortranなど複数のプログラミング言語をサポートしています。

## オプション

### **-q, --quiet, --silent**

GDBを静かなモードで起動し、導入部と著作権メッセージを表示しません

```console
$ gdb -q ./myprogram
(gdb) 
```

### **-c, --core=FILE**

コアダンプファイルを分析します

```console
$ gdb -q ./myprogram -c core.12345
Reading symbols from ./myprogram...
Core was generated by `./myprogram'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000555555555160 in main () at main.c:15
```

### **-p, --pid=PID**

実行中のプロセスにアタッチします

```console
$ gdb -q -p 12345
Attaching to process 12345
Reading symbols from /path/to/process...
```

### **--args**

デバッグ対象のプログラムに引数を渡します

```console
$ gdb --args ./myprogram arg1 arg2
```

### **-x, --command=FILE**

ファイルからGDBコマンドを実行します

```console
$ gdb -q -x commands.gdb ./myprogram
```

### **-d, --directory=DIRECTORY**

ソースファイルを検索するパスにDIRECTORYを追加します

```console
$ gdb -q -d /path/to/source ./myprogram
```

## 使用例

### 基本的なデバッグセッション

```console
$ gdb ./myprogram
(gdb) break main
Breakpoint 1 at 0x1149: file main.c, line 5.
(gdb) run
Starting program: /home/user/myprogram 

Breakpoint 1, main () at main.c:5
5       int x = 10;
(gdb) next
6       printf("x = %d\n", x);
(gdb) print x
$1 = 10
(gdb) continue
Continuing.
x = 10
[Inferior 1 (process 12345) exited normally]
```

### セグメンテーション違反のデバッグ

```console
$ gdb ./myprogram
(gdb) run
Starting program: /home/user/myprogram 

Program received signal SIGSEGV, Segmentation fault.
0x0000555555555160 in access_array (index=10) at main.c:8
8       return array[index];
(gdb) backtrace
#0  0x0000555555555160 in access_array (index=10) at main.c:8
#1  0x0000555555555189 in main () at main.c:15
(gdb) print array
$1 = (int *) 0x5555555592a0
(gdb) print index
$2 = 10
```

### 条件付きブレークポイントの設定

```console
$ gdb ./myprogram
(gdb) break 25 if i == 100
Breakpoint 1 at 0x1234: file main.c, line 25.
(gdb) run
Starting program: /home/user/myprogram 

Breakpoint 1, main () at main.c:25
25      printf("i reached 100\n");
```

## ヒント:

### TUIモードを使用して視覚化を向上させる

テキストユーザーインターフェース（TUI）モードを `tui enable` で有効にすると、ソースコードとGDBコマンドを同時に表示できます。

```console
(gdb) tui enable
```

### よく使うコマンドを.gdbinitに保存する

ホームディレクトリに `.gdbinit` ファイルを作成し、頻繁に使用するコマンドを記述しておくと、GDB起動時に自動的に実行されます。

### ウォッチポイントで変数を監視する

変数の値が変更されるたびに実行を停止するウォッチポイントを設定できます：

```console
(gdb) watch my_variable
```

### メモリの内容を調査する

`x` コマンドを使用してメモリを調査できます：

```console
(gdb) x/10i $pc  # プログラムカウンタから10命令を表示する
```

### Pythonエクステンションを使用する

GDBはPythonスクリプト機能を持っており、カスタムコマンドや視覚化を作成できます：

```console
(gdb) python print("Hello from Python in GDB")
```

## よくある質問

#### Q1. ブレークポイントを設定するにはどうすればよいですか？
A. `break` コマンドの後に関数名、行番号、またはファイル:行の組み合わせを指定します。例：`break main`、`break 42`、または `break file.c:42`。

#### Q2. コードをステップ実行するにはどうすればよいですか？
A. `next` を使用すると現在の行を実行し、次の行で停止します（関数呼び出しをステップオーバー）。`step` を使用すると関数呼び出しの中に入り、`continue` を使用すると次のブレークポイントまで実行を再開します。

#### Q3. 変数の値を表示するにはどうすればよいですか？
A. `print` コマンドの後に変数名を指定します：`print my_variable`。複雑な構造体の場合、`print *pointer` でポインタの参照先を表示したり、`print my_array[5]` で配列要素にアクセスしたりできます。

#### Q4. コアダンプを調査するにはどうすればよいですか？
A. `gdb program core_file` または `gdb -c core_file program` を実行して、プログラムとコアダンプファイルを読み込みます。

#### Q5. GDBを終了するにはどうすればよいですか？
A. GDBプロンプトで `quit` または `q` と入力するか、Ctrl+Dを押します。

## 参考資料

https://sourceware.org/gdb/current/onlinedocs/gdb/

## 改訂履歴

- 2025/05/04 初版作成