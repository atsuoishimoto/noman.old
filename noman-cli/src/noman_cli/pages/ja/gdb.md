# gdb コマンド
プログラムのデバッグと実行時の動作分析を行うための対話型デバッガです。

## 概要
GDB（GNU Debugger）は、C、C++、Fortranなどのプログラミング言語で書かれたプログラムのデバッグを支援するツールです。プログラムの実行を制御し、クラッシュの原因を特定したり、変数の値を確認したり、コードの実行をステップバイステップで追跡したりすることができます。

## オプション
### **-q, --quiet, --silent**
起動時の著作権情報やバージョン情報などを表示しない静かなモードで起動します。

```console
$ gdb -q ./myprogram
Reading symbols from ./myprogram...
(gdb) 
```

### **-c FILE**
指定したコアファイルを使用してデバッグを開始します。プログラムがクラッシュした際に生成されたコアダンプを分析するのに役立ちます。

```console
$ gdb -q ./myprogram -c core
Reading symbols from ./myprogram...
Core was generated by `./myprogram'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000555555555160 in main () at main.c:10
10      *ptr = 100;  // ここでセグメンテーション違反が発生
```

### **-p PID**
実行中のプロセスにアタッチしてデバッグします。プロセスIDを指定します。

```console
$ gdb -q -p 1234
Attaching to process 1234
Reading symbols from /path/to/program...
0x00007f8b4c9a2e50 in poll () from /lib/x86_64-linux-gnu/libc.so.6
(gdb) 
```

### **--args**
プログラムに引数を渡す際に使用します。

```console
$ gdb --args ./myprogram arg1 arg2
Reading symbols from ./myprogram...
(gdb) run
Starting program: /path/to/myprogram arg1 arg2
```

## 使用例
### 基本的なデバッグセッションの開始
```console
$ gdb ./myprogram
GNU gdb (Ubuntu 9.2-0ubuntu1~20.04) 9.2
Copyright (C) 2020 Free Software Foundation, Inc.
...
Reading symbols from ./myprogram...
(gdb) break main
Breakpoint 1 at 0x1149: file main.c, line 5.
(gdb) run
Starting program: /home/user/myprogram 

Breakpoint 1, main () at main.c:5
5       int x = 10;
(gdb) 
```

### 変数の値を確認する
```console
$ gdb -q ./myprogram
Reading symbols from ./myprogram...
(gdb) break 10
Breakpoint 1 at 0x1169: file main.c, line 10.
(gdb) run
Starting program: /home/user/myprogram 

Breakpoint 1, main () at main.c:10
10      printf("x = %d\n", x);
(gdb) print x
$1 = 42
(gdb) 
```

### バックトレースの表示
```console
$ gdb -q ./myprogram
Reading symbols from ./myprogram...
(gdb) run
Starting program: /home/user/myprogram 
Program received signal SIGSEGV, Segmentation fault.
0x0000555555555160 in foo () at main.c:15
15      *ptr = 100;
(gdb) backtrace
#0  0x0000555555555160 in foo () at main.c:15
#1  0x0000555555555189 in main () at main.c:21
(gdb) 
```

## ヒント:
### デバッグシンボルを含めてコンパイルする
GDBを効果的に使用するには、プログラムをコンパイルする際に `-g` オプションを使用してデバッグシンボルを含めることが重要です。
```console
$ gcc -g -o myprogram main.c
```

### コアダンプを有効にする
プログラムがクラッシュした際にコアダンプを生成するには、以下のコマンドを実行します。
```console
$ ulimit -c unlimited
```

### 便利なGDBコマンド
- `break` (または `b`): ブレークポイントを設定します
- `run` (または `r`): プログラムを実行します
- `continue` (または `c`): 実行を再開します
- `next` (または `n`): 次の行に進みます（関数呼び出しをスキップ）
- `step` (または `s`): 次の行に進みます（関数内に入る）
- `print` (または `p`): 変数の値を表示します
- `backtrace` (または `bt`): コールスタックを表示します
- `quit` (または `q`): GDBを終了します

## よくある質問
#### Q1. GDBでプログラムを実行するにはどうすればいいですか？
A. GDBでプログラムを起動した後、`run`（または`r`）コマンドを使用します。引数を渡す場合は `run arg1 arg2` のように指定します。

#### Q2. ブレークポイントはどのように設定しますか？
A. `break 関数名`（例: `break main`）または `break ファイル名:行番号`（例: `break main.c:15`）を使用します。

#### Q3. プログラムがクラッシュした原因を調べるにはどうすればいいですか？
A. `backtrace`（または`bt`）コマンドを使用してコールスタックを表示し、クラッシュが発生した場所と呼び出し経路を確認します。

#### Q4. 変数の値を変更するにはどうすればいいですか？
A. `set variable 変数名=値`（例: `set variable x=42`）または短縮形の `set var x=42` を使用します。

#### Q5. macOSでGDBを使用する際の注意点はありますか？
A. macOSではセキュリティ上の理由からGDBの使用に制限があります。GDBを使用するには、コード署名が必要です。また、多くのmacOSユーザーはLLDBを代替として使用しています。

## 参考資料
https://sourceware.org/gdb/current/onlinedocs/gdb/

## Revisions
- 2025/04/29 初版作成