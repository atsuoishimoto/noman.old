# mkfifo コマンド

指定した名前の名前付きパイプ（FIFO）を作成します。

## 概要

`mkfifo`コマンドは、名前付きパイプまたはFIFO（First-In-First-Out）と呼ばれる特殊なファイルを作成します。これらのパイプは、一時ファイルを使用せずにプロセス間で通信することを可能にします。`|`記号で作成される通常のパイプとは異なり、名前付きパイプは削除されるまでファイルシステム上に存在し続け、関連のないプロセス間での通信を可能にします。

## オプション

### **-m, --mode=MODE**

作成するFIFOのパーミッションモードを設定します（デフォルトは0666からumaskを引いた値）

```console
$ mkfifo -m 0600 private_pipe
$ ls -l private_pipe
prw-------  1 user  staff  0 5月  4 10:15 private_pipe
```

### **-Z, --context=CTX**

作成されるFIFOのSELinuxセキュリティコンテキストをCTXに設定します

```console
$ mkfifo -Z user_u:object_r:user_fifo_t:s0 selinux_pipe
```

### **--help**

ヘルプ情報を表示して終了します

```console
$ mkfifo --help
使用法: mkfifo [オプション]... 名前...
指定した名前で名前付きパイプ (FIFO) を作成します。
...
```

### **--version**

バージョン情報を出力して終了します

```console
$ mkfifo --version
mkfifo (GNU coreutils) 8.32
...
```

## 使用例

### 基本的なFIFO作成

```console
$ mkfifo my_pipe
$ ls -l my_pipe
prw-r--r--  1 user  staff  0 5月  4 10:20 my_pipe
```

### 名前付きパイプを使用したプロセス間通信

```console
# ターミナル1: パイプを作成して書き込む
$ mkfifo message_pipe
$ echo "プロセス1からこんにちは" > message_pipe

# ターミナル2: パイプから読み取る
$ cat < message_pipe
プロセス1からこんにちは
```

### 複数のFIFOを一度に作成

```console
$ mkfifo pipe1 pipe2 pipe3
$ ls -l pipe*
prw-r--r--  1 user  staff  0 5月  4 10:25 pipe1
prw-r--r--  1 user  staff  0 5月  4 10:25 pipe2
prw-r--r--  1 user  staff  0 5月  4 10:25 pipe3
```

## ヒント:

### ブロッキング動作を理解する

プロセスが空のFIFOから読み取ろうとすると、データが利用可能になるまでブロックされます。同様に、FIFOへの書き込みは、別のプロセスがデータを読み取るまでブロックされます。この動作は、プロセス間通信を設計する際に理解しておくことが重要です。

### リダイレクションとの併用

名前付きパイプは標準入出力のリダイレクションとうまく連携します。あるコマンドの出力を名前付きパイプにリダイレクトし、その名前付きパイプからの入力を別のコマンドにリダイレクトすることができます。

### クリーンアップ

名前付きパイプは、`rm`で明示的に削除されるまでファイルシステム上に残ります。混乱を避けるため、不要になったパイプは忘れずに削除しましょう。

### パーミッションの重要性

特にマルチユーザー環境では、どのプロセスがパイプから読み取りや書き込みができるかを制御するために、名前付きパイプに適切なパーミッションを設定してください。

## よくある質問

#### Q1. 名前付きパイプと通常のパイプの違いは何ですか？
A. 通常のパイプ（`|`を使用）は、接続されたプロセスが実行されている間のみ存在します。名前付きパイプは削除されるまでファイルシステム上にファイルとして存在し、関連のないプロセス間での通信を可能にします。

#### Q2. 名前付きパイプを双方向通信に使用できますか？
A. いいえ、名前付きパイプは一方向です。双方向通信には、2つの名前付きパイプを作成する必要があります。

#### Q3. 名前付きパイプに書き込むとプロセスがハングするのはなぜですか？
A. 名前付きパイプへの書き込みは、別のプロセスがそこから読み取るまでブロックされます。読み取りプロセスがあることを確認するか、パイプをノンブロッキングモードで開いてください。

#### Q4. 名前付きパイプを削除するにはどうすればよいですか？
A. 通常のファイルと同様に、`rm`コマンドを使用します：`rm my_pipe`

## 参考文献

https://www.gnu.org/software/coreutils/manual/html_node/mkfifo-invocation.html

## 改訂履歴

2025/05/04 初版作成