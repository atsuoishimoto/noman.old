# git rebase コマンド

コミット履歴を再構成し、ブランチの起点を変更する。

## 概要

`git rebase` は、あるブランチのコミットを別のブランチの先端に移動させるコマンドです。これにより、コミット履歴をよりクリーンで直線的なものにすることができます。マージとは異なり、リベースはコミット履歴を書き換えるため、共有ブランチでの使用には注意が必要です。

## オプション

### **-i, --interactive**

対話的なリベースを開始します。コミットの並べ替え、編集、統合などが可能になります。

```console
$ git rebase -i HEAD~3
# エディタが開き、最新の3つのコミットを操作できる
# pick f7f3f6d コミットメッセージ1
# pick 310154e コミットメッセージ2
# pick a5f4a0d コミットメッセージ3
```

### **--onto <newbase>**

特定のコミットやブランチの上にリベースします。

```console
$ git rebase --onto main feature~3 feature
# featureブランチの最新から3つ前までのコミットを除外し、mainブランチの先端にリベース
```

### **--continue**

コンフリクト解決後にリベースを続行します。

```console
$ git rebase --continue
# コンフリクトを解決した後、リベース処理を続行する
```

### **--abort**

リベースを中止し、元の状態に戻します。

```console
$ git rebase --abort
# リベース処理を中止して元の状態に戻る
```

## 使用例

### 基本的なリベース

```console
$ git checkout feature
$ git rebase main
# featureブランチのコミットをmainブランチの先端に移動させる
```

### 対話的リベースでコミットを統合

```console
$ git rebase -i HEAD~4
# エディタで以下のように編集
# pick 01ab234 最初のコミット
# squash 56cd890 2番目のコミット
# squash ef12345 3番目のコミット
# pick 67gh890 4番目のコミット
# 保存して閉じると、最初の3つのコミットが1つに統合される
```

### 特定の範囲のコミットをリベース

```console
$ git rebase --onto main feature~5 feature
# featureブランチの最新5つのコミットをmainブランチの先端にリベース
```

## ヒント:

### 共有ブランチでのリベース注意

すでにプッシュされた共有ブランチでリベースを行うと、他の開発者に問題が生じる可能性があります。基本的に「公開されたコミットはリベースしない」というルールを守りましょう。

### コンフリクト解決

リベース中にコンフリクトが発生した場合は、ファイルを編集してコンフリクトを解決し、`git add` でマークしてから `git rebase --continue` を実行します。

### リベース前のブランチバックアップ

重要なリベース操作の前には、`git branch backup-branch` でバックアップブランチを作成しておくと安全です。

### 自動スカッシュ

`git rebase -i` で `fixup` コマンドを使うと、コミットメッセージを保持せずにコミットを統合できます。

## よくある質問

#### Q1. リベースとマージの違いは何ですか？
A. マージは2つのブランチの履歴を結合するのに対し、リベースはあるブランチのコミットを別のブランチの先端に移動させます。リベースはより直線的な履歴を作りますが、コミット履歴を書き換えるため共有ブランチでは注意が必要です。

#### Q2. リベース中にコンフリクトが発生したらどうすればいいですか？
A. コンフリクトが発生したファイルを編集して解決し、`git add <ファイル名>` でマークした後、`git rebase --continue` を実行します。リベースを中止したい場合は `git rebase --abort` を使用します。

#### Q3. 間違ってリベースしてしまった場合、元に戻せますか？
A. `git reflog` で操作履歴を確認し、リベース前のコミットハッシュを見つけて `git reset --hard <コミットハッシュ>` で戻すことができます。ただし、リベース前にバックアップブランチを作成しておくことをお勧めします。

#### Q4. プッシュ済みのブランチをリベースした場合はどうなりますか？
A. リモートリポジトリにプッシュするには `git push --force` が必要になりますが、他の開発者が同じブランチを使用している場合、彼らの作業に問題が生じる可能性があります。共有ブランチでのリベースは避けるべきです。

## 参考資料

https://git-scm.com/docs/git-rebase

## Revisions

- 2025/04/30 初版作成