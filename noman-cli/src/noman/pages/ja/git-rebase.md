# git-rebase コマンド

別のベースの先端に対してコミットを再適用します。

## 概要

`git rebase`は、ブランチのベースを一つのコミットから別のコミットに変更するために使用され、あたかも異なるコミットからブランチを作成したかのように見せることができます。これにより、元のブランチの各コミットに対して新しいコミットを作成することでコミット履歴が書き換えられ、線形的なプロジェクト履歴が生成されます。

## オプション

### **-i, --interactive**

リベース処理中にコミットの編集（並べ替え、編集、スカッシュ、削除など）を行うことができます。

```console
$ git rebase -i HEAD~3
# 以下のようなエディタが開く:
# pick f7f3f6d 機能Aの変更
# pick 310154e 機能Aのタイポ修正
# pick a5f4a0d 機能Bの追加
```

### **--onto \<newbase\>**

コミットが再適用される新しいベースコミットを指定します。

```console
$ git rebase --onto main feature-branch~3 feature-branch
# feature-branch~3からfeature-branchまでのコミットをmainの上に移動する
```

### **--continue**

コンフリクトを解決した後にリベース操作を続行します。

```console
$ git rebase --continue
# コンフリクトを解決して変更を追加した後に実行する
```

### **--abort**

リベース操作を中止し、ブランチを元の状態に戻します。

```console
$ git rebase --abort
# リベースをキャンセルして元のブランチ状態に戻す
```

### **--skip**

現在のコミットをスキップして次のコミットに進みます。

```console
$ git rebase --skip
# 問題のある現在のコミットをスキップする
```

## 使用例

### 基本的なリベース

```console
$ git checkout feature-branch
$ git rebase main
# feature-branchを最新のmainの上にリベースする
```

### インタラクティブリベースでコミットをスカッシュする

```console
$ git rebase -i HEAD~4
# エディタで、一部の「pick」行を「squash」または「s」に変更する
# pick 01d1124 機能Xの追加
# squash 6340aaa 機能Xのバグ修正
# squash ebfd367 機能Xの改善
# pick 30e0ccb 機能Yの追加
```

### ブランチを異なるベースに移動する

```console
$ git rebase --onto new-base old-base branch-to-move
# old-baseとbranch-to-moveの間のコミットをnew-baseの上に移動する
```

## ヒント:

### プッシュ前にリベースする

クリーンな履歴を確保するために、プッシュする前にローカルブランチをリベースしましょう。ただし、他の人が作業をベースにしている可能性がある共有リポジトリにすでにプッシュされたコミットは、絶対に確信がない限りリベースしないでください。

### バックアップブランチを作成する

複雑なリベースを実行する前に、バックアップブランチを作成しましょう：

```console
$ git branch backup-branch
```

### リベース中のコンフリクト解決

コンフリクトが発生すると、Gitはリベースを一時停止します。コンフリクトを解決した後：

```console
$ git add <解決したファイル>
$ git rebase --continue
```

### Autosquashの使用

修正コミットを作成する際に`--fixup`を使用し、後で`--autosquash`でリベースします：

```console
$ git commit --fixup <コミットハッシュ>
$ git rebase -i --autosquash <ベース>
```

## よくある質問

#### Q1. マージとリベースの違いは何ですか？
A. マージは履歴を保持しマージコミットを作成しますが、リベースは新しいコミットを作成して履歴を書き換え、線形的な履歴を生成します。

#### Q2. リベースを避けるべき場合はいつですか？
A. 公開リポジトリにプッシュされ、他の人がプルした可能性のあるコミットのリベースは避けるべきです。履歴が書き換えられ、共同作業者にコンフリクトを引き起こす可能性があるためです。

#### Q3. リベースを元に戻すにはどうすればよいですか？
A. リベースされたコミットをまだプッシュしていない場合は、`git reflog`を使用してリベース前のコミットを見つけ、`git reset --hard <コミットハッシュ>`でその状態に戻ります。

#### Q4. 複数のブランチを一度にリベースできますか？
A. いいえ、各ブランチを個別にリベースする必要があります。

#### Q5. リベース中の複雑なコンフリクトを解決するにはどうすればよいですか？
A. 各ファイルのコンフリクトを解決し、`git add`で解決したファイルを追加してから`git rebase --continue`を使用します。特定のコミットが問題すぎる場合は、`git rebase --skip`を使用してスキップできます。

## 参考資料

https://git-scm.com/docs/git-rebase

## 改訂履歴

- 2025/05/04 初回改訂