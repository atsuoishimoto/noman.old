# while コマンド

条件が真である間、コマンドを繰り返し実行します。

## 概要

`while` コマンドは、指定された条件が真（終了ステータスが0）である限り、コマンドブロックを繰り返し実行するシェルの制御構造です。ループ処理やバックグラウンドタスクの監視など、繰り返し処理が必要な場合に使用されます。

## 構文

### **基本構文**

`while` の基本的な構文は以下の通りです：

```bash
while 条件コマンド
do
  実行コマンド
done
```

条件コマンドが真（終了ステータス0）を返す限り、実行コマンドが繰り返し実行されます。

### **break と continue**

ループ内で制御を変更するには：

```bash
while 条件
do
  if 別の条件; then
    break    # ループを完全に抜ける
  fi
  
  if 別の条件2; then
    continue # 現在の繰り返しをスキップして次の繰り返しへ
  fi
  
  コマンド
done
```

## 使用例

### 数値カウントアップ

```console
$ i=1
$ while [ $i -le 5 ]
> do
>   echo "カウント: $i"
>   i=$((i+1))
> done
カウント: 1
カウント: 2
カウント: 3
カウント: 4
カウント: 5
```

### ファイルの各行を処理

```console
$ cat names.txt
Alice
Bob
Charlie
$ while read name
> do
>   echo "こんにちは、$nameさん"
> done < names.txt
こんにちは、Aliceさん
こんにちは、Bobさん
こんにちは、Charlieさん
```

### 無限ループ（Ctrl+Cで停止）

```console
$ while true
> do
>   echo "Ctrl+Cで停止するまで実行し続けます"
>   sleep 1
> done
Ctrl+Cで停止するまで実行し続けます
Ctrl+Cで停止するまで実行し続けます
Ctrl+Cで停止するまで実行し続けます
^C
```

### コマンドの実行結果を条件にする

```console
$ while ping -c 1 example.com > /dev/null
> do
>   echo "サーバーは応答しています"
>   sleep 5
> done
サーバーは応答しています
サーバーは応答しています
...
```

## ヒント:

### 無限ループに注意

`while true` や `while :` は無限ループを作成します。必ず内部に終了条件を設けるか、`break`文を使用してループを抜ける手段を用意しましょう。

### 変数の更新を忘れない

条件に使用している変数を更新しないと、無限ループになる可能性があります。例えば、カウンタ変数は必ず増減させましょう。

### ファイル処理の効率化

ファイルを1行ずつ処理する場合は、`cat file | while read line` よりも `while read line < file` または `while read line; do ...; done < file` の方が効率的です。

### シェル変数のスコープに注意

パイプを使用した `while` ループ（`command | while read line`）では、ループ内で設定した変数はサブシェルで実行されるため、ループ終了後にアクセスできません。

## よくある質問

#### Q1. while ループと for ループの違いは何ですか？
A. `while` ループは条件が真である限り繰り返しますが、`for` ループは指定されたリストの各要素に対して1回ずつ実行します。不定回数の繰り返しには `while` が適しています。

#### Q2. while ループを途中で終了するにはどうすればよいですか？
A. ループ内で `break` コマンドを使用すると、即座にループを終了します。条件付きで終了する場合は `if` 文と組み合わせて使用します。

#### Q3. ループの現在の繰り返しをスキップするにはどうすればよいですか？
A. `continue` コマンドを使用すると、現在の繰り返しの残りの部分をスキップして、次の繰り返しに進みます。

#### Q4. 無限ループを作成するにはどうすればよいですか？
A. `while true` または `while :` を使用すると無限ループを作成できます。ただし、必ず内部に終了条件を設けるか、Ctrl+Cで停止できるようにしてください。

## 参照

https://www.gnu.org/software/bash/manual/html_node/Looping-Constructs.html

## 改訂

- 2025/04/30 初版作成