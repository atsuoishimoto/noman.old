# ln コマンド

ファイル間のリンクを作成します。

## 概要

`ln` コマンドはファイルやディレクトリへのリンクを作成します。デフォルトではハードリンクを作成し、`-s` オプションを使用するとシンボリックリンクを作成します。ハードリンクはディスク上のファイルデータを直接指し、シンボリックリンクは名前で別のファイルやディレクトリを指す特殊なファイルです。

## オプション

### **-s, --symbolic**

ハードリンクではなくシンボリックリンクを作成します。

```console
$ ln -s 対象ファイル リンク名
$ ls -l リンク名
lrwxrwxrwx 1 user user 10 5月 4 10:00 リンク名 -> 対象ファイル
```

### **-f, --force**

既存の宛先ファイルを削除します。

```console
$ ln -sf 対象ファイル 既存のリンク
```

### **-n, --no-dereference**

ディレクトリへのシンボリックリンクである宛先を通常のファイルとして扱います。

```console
$ ln -sfn 新しい対象 既存のリンク
```

### **-v, --verbose**

リンクされた各ファイルの名前を表示します。

```console
$ ln -sv 対象ファイル リンク名
'リンク名' -> '対象ファイル'
```

### **-r, --relative**

リンクの場所を基準にした相対的なシンボリックリンクを作成します。

```console
$ ln -sr ../dir1/file1 リンク名
```

## 使用例

### ハードリンクの作成

```console
$ echo "オリジナルの内容" > original.txt
$ ln original.txt hardlink.txt
$ ls -l *txt
-rw-r--r-- 2 user user 16 5月 4 10:00 hardlink.txt
-rw-r--r-- 2 user user 16 5月 4 10:00 original.txt
```

### ファイルへのシンボリックリンクの作成

```console
$ ln -s /path/to/file.txt symlink.txt
$ ls -l symlink.txt
lrwxrwxrwx 1 user user 15 5月 4 10:00 symlink.txt -> /path/to/file.txt
```

### ディレクトリへのシンボリックリンクの作成

```console
$ ln -s /usr/local/bin bin_link
$ ls -l bin_link
lrwxrwxrwx 1 user user 14 5月 4 10:00 bin_link -> /usr/local/bin
```

### 相対シンボリックリンクの作成

```console
$ mkdir -p dir1/subdir
$ touch dir1/file.txt
$ ln -sr dir1/file.txt dir1/subdir/link.txt
$ ls -l dir1/subdir/link.txt
lrwxrwxrwx 1 user user 9 5月 4 10:00 dir1/subdir/link.txt -> ../file.txt
```

## ヒント:

### ハードリンクとシンボリックリンクの違い

- ハードリンクは元のファイルと同じinodeを共有し、同じディスク上の物理データを参照します。どちらかのファイルを変更すると両方に影響します。
- ハードリンクはファイルシステムをまたぐことができず、ディレクトリにリンクすることもできません。
- シンボリックリンクは名前で別のファイルを指す別個のファイルであり、ファイルシステムをまたぐことができます。
- シンボリックリンクの元のファイルが削除されると、リンクは「壊れた」状態になり、何も指さなくなります。

### 既存のシンボリックリンクの更新

既存のシンボリックリンクを安全に更新するには、`-sfn` を一緒に使用します：
```console
$ ln -sfn 新しい対象 既存のリンク
```

### 壊れたシンボリックリンクの確認

現在のディレクトリで壊れたシンボリックリンクを見つけるには：
```console
$ find . -type l -exec test ! -e {} \; -print
```

## よくある質問

#### Q1. ハードリンクとシンボリックリンクの違いは何ですか？
A. ハードリンクはファイルのinode（ディスク上のデータ）を直接参照し、ファイルシステムをまたいだり、ディレクトリにリンクしたりすることはできません。シンボリックリンクはパスで別のファイルを参照するポインタファイルであり、ファイルシステムをまたいだり、ディレクトリにリンクしたりすることができます。

#### Q2. 既存のシンボリックリンクを更新するにはどうすればよいですか？
A. `ln -sf 新しい対象 既存のリンク` を使用して、既存のリンクを置き換える新しいリンクの作成を強制します。

#### Q3. ディレクトリへのハードリンクを作成できますか？
A. いいえ、ほとんどのUnix/Linuxシステムではファイルシステムのループを防ぐために、ディレクトリへのハードリンクは許可されていません。

#### Q4. ファイルがシンボリックリンクかどうかを確認するにはどうすればよいですか？
A. `ls -l ファイル名` を使用します - シンボリックリンクはパーミッションの先頭に「l」が表示され、ターゲットが矢印（->）で表示されます。

## macOSに関する考慮事項

macOSでは、`ln` コマンドはLinuxと同様に動作しますが、いくつかの違いがあります：
- `-r`（相対）オプションは古いmacOSバージョンでは利用できない場合があります。
- システム間の互換性のために、問題が発生した場合は `-s` だけでなく完全な `-symbolic` オプションを使用してください。

## 参考資料

https://www.gnu.org/software/coreutils/manual/html_node/ln-invocation.html

## 改訂履歴

- 2025/05/04 初版