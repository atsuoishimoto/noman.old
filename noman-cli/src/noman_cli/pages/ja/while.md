# while コマンド

条件が真である限り、コマンドを繰り返し実行します。

## 概要

`while` コマンドはシェルの構文で、指定された条件が真である限り、一連のコマンドを繰り返し実行するループを作成します。ファイルを1行ずつ処理したり、カウントダウンタイマーを実装したりするなど、特定の条件が満たされるまで繰り返す必要があるタスクのシェルスクリプトでよく使用されます。

## オプション

`while` コマンド自体は、独立したUnixコマンドのようなオプションを持ちません。代わりに、特定の構文を持つシェルの制御構造です：

```bash
while 条件; do
  コマンド
done
```

## 使用例

### カウンターを使用した基本的なwhileループ

```console
$ i=1
$ while [ $i -le 5 ]; do
>   echo "カウント: $i"
>   i=$((i+1))
> done
カウント: 1
カウント: 2
カウント: 3
カウント: 4
カウント: 5
```

### ファイルを1行ずつ読み込む

```console
$ cat names.txt
Alice
Bob
Charlie
$ while read name; do
>   echo "こんにちは、$name さん！"
> done < names.txt
こんにちは、Alice さん！
こんにちは、Bob さん！
こんにちは、Charlie さん！
```

### break条件付きの無限ループ

```console
$ i=1
$ while true; do
>   echo "繰り返し $i"
>   if [ $i -eq 3 ]; then
>     echo "ループを抜けます"
>     break
>   fi
>   i=$((i+1))
> done
繰り返し 1
繰り返し 2
繰り返し 3
ループを抜けます
```

### 条件が満たされるまで待機

```console
$ while [ ! -f /tmp/ready.txt ]; do
>   echo "ファイルが現れるのを待っています..."
>   sleep 1
> done
ファイルが現れるのを待っています...
ファイルが現れるのを待っています...
ファイルが現れるのを待っています...
```

## ヒント:

### `break` を使って早期に終了する

`break` コマンドを while ループ内で使用すると、条件に関係なく即座に終了できます：

```bash
while 条件; do
  if [別の条件]; then
    break  # ループを終了する
  fi
  # コマンド
done
```

### `continue` を使って繰り返しをスキップする

`continue` コマンドは現在の繰り返しの残りをスキップして、条件チェックに戻ります：

```bash
while 条件; do
  if [スキップ条件]; then
    continue  # 次の繰り返しにスキップ
  fi
  # continueが実行されると実行されないコマンド
done
```

### 無限ループを避ける

while ループには必ず終了する方法を確保してください。最終的に偽になる条件を含めるか、`break` ステートメントを使用します。誤って無限ループを作成した場合は、Ctrl+Cを押して終了できます。

### タイムドループには `sleep` を使用する

条件をポーリングする場合は、過剰なCPU使用を防ぐために `sleep` コマンドを使用します：

```bash
while [ 条件 ]; do
  # コマンド
  sleep 1  # 再度チェックする前に1秒待機
done
```

## よくある質問

#### Q1. `while` と `until` の違いは何ですか？
A. `while` は条件が真である限りコマンドを実行しますが、`until` は条件が偽である限り（真になるまで）コマンドを実行します。

#### Q2. whileループでファイルを1行ずつ読み込むにはどうすればよいですか？
A. `while read line; do コマンド; done < file.txt` を使用して、ファイルの各行を処理できます。

#### Q3. 無限ループを作成するにはどうすればよいですか？
A. `while true; do コマンド; done` または `while :; do コマンド; done` を使用して無限ループを作成できます。ループを終了する方法（`break` ステートメントなど）を含めることを忘れないでください。

#### Q4. whileループをネストできますか？
A. はい、whileループを他のwhileループ内にネストできます。各ループには独自の `do` と `done` キーワードが必要です。

#### Q5. whileをコマンド出力と一緒に使用するにはどうすればよいですか？
A. コマンド出力をwhileループにパイプできます：`command | while read line; do 何か処理; done`

## 参考文献

https://www.gnu.org/software/bash/manual/html_node/Looping-Constructs.html

## 改訂履歴

2025/05/04 初版作成