# top コマンド

システムのプロセスをリアルタイムで監視し、CPU・メモリ使用率などのリソース情報を表示します。

## 概要

`top` コマンドはシステムのパフォーマンスをリアルタイムで監視するためのツールです。実行中のプロセスのリスト、CPU使用率、メモリ使用状況、ロード平均などの情報を動的に更新して表示します。システム管理者やユーザーがシステムの状態を把握し、リソースを多く消費しているプロセスを特定するのに役立ちます。

## オプション

### **-d [秒数]**

更新間隔を指定します（デフォルトは3秒）

```console
$ top -d 5
# 5秒ごとに画面が更新される
```

### **-n [回数]**

指定した回数だけ更新して終了します

```console
$ top -n 3
# 3回更新した後に自動的に終了する
```

### **-p [PID]**

特定のプロセスIDのみを監視します

```console
$ top -p 1234
# PID 1234のプロセスのみを監視する
```

### **-u [ユーザー名]**

特定のユーザーのプロセスのみを表示します

```console
$ top -u root
# rootユーザーのプロセスのみを表示する
```

## 対話的コマンド

top実行中に使用できるキーコマンドです：

### **h**

ヘルプ画面を表示します

```console
# top実行中にhキーを押すとヘルプが表示される
```

### **k**

プロセスを終了（kill）します

```console
# top実行中にkキーを押し、PIDとシグナルを入力するとプロセスを終了できる
```

### **f**

表示するフィールド（列）を選択します

```console
# top実行中にfキーを押すと表示する列を選択できる
```

### **r**

プロセスの優先度（nice値）を変更します

```console
# top実行中にrキーを押し、PIDと新しいnice値を入力する
```

## 使用例

### 基本的な使用方法

```console
$ top
top - 14:23:45 up 3 days,  5:12,  2 users,  load average: 0.15, 0.10, 0.09
Tasks: 213 total,   1 running, 212 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.3 us,  0.7 sy,  0.0 ni, 96.8 id,  0.2 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :  16384.0 total,   9120.5 free,   3421.3 used,   3842.2 buff/cache
MiB Swap:   8192.0 total,   8192.0 free,      0.0 used.  12962.7 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
 1234 user      20   0 3256892 112236  42784 S   2.0   0.7   5:23.02 firefox
 5678 user      20   0  743648  22548  15416 S   1.3   0.1   2:42.15 terminal
```

### メモリ使用量でソート

```console
# top実行中にMキーを押すとメモリ使用量でソートされる
```

### CPU使用率でソート

```console
# top実行中にPキーを押すとCPU使用率でソートされる
```

## ヒント:

### バッチモードでの使用

`top -b -n 1 > top_output.txt` を使用すると、topの出力を1回だけキャプチャしてファイルに保存できます。これはシステム監視スクリプトで役立ちます。

### 特定のプロセスの監視

`top -p $(pgrep firefox | tr '\n' ',' | sed 's/,$//')` のようにすると、特定のプログラム（この例ではfirefox）の全インスタンスを監視できます。

### カラー表示の切り替え

`z`キーを押すとカラー表示のオン/オフを切り替えられます。これは白黒端末や出力をテキストファイルに保存する場合に便利です。

### 表示の絞り込み

`o`または`O`キーを押すとフィルタリングオプションが表示され、特定の条件に合うプロセスのみを表示できます。

## よくある質問

#### Q1. topとpsの違いは何ですか？
A. `top`はリアルタイムで更新される動的な表示を提供するのに対し、`ps`は実行時点でのスナップショットを表示します。継続的な監視には`top`が適しています。

#### Q2. topの表示を更新せずに終了するにはどうすればいいですか？
A. `q`キーを押すと即座に終了します。

#### Q3. 特定のユーザーのプロセスだけを表示するには？
A. `top -u ユーザー名`を使用するか、top実行中に`u`キーを押してユーザー名を入力します。

#### Q4. CPUコアごとの使用率を表示するには？
A. top実行中に`1`キーを押すと、各CPUコアの使用率が個別に表示されます。

#### Q5. topの出力を並べ替えるには？
A. 様々なキーで並べ替えができます。例えば、`P`でCPU使用率、`M`でメモリ使用率、`T`で実行時間順に並べ替えます。

## macOSでの注意点

macOSの`top`コマンドはLinuxとは若干異なります。例えば、対話的コマンドが異なる場合があり、`o`キーを押すとソート順を変更できます。また、macOSでは`-o`オプションを使って起動時にソート順を指定できます（例：`top -o cpu`）。

macOSでより詳細な情報を得るには、代替として`htop`をインストールすることも検討してください（`brew install htop`でインストール可能）。

## 参考資料

https://man7.org/linux/man-pages/man1/top.1.html

## 改訂履歴

- 2025/04/30 初版作成