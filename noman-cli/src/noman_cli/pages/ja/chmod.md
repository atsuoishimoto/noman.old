# chmod コマンド

ファイルやディレクトリのアクセス権限を変更します。

## 概要

`chmod`（change mode）は、ファイルやディレクトリのアクセス権限を変更するコマンドです。Unixシステムでは、各ファイルに対して「所有者」「グループ」「その他のユーザー」の3種類のユーザーカテゴリに対して、「読み取り(r)」「書き込み(w)」「実行(x)」の権限を設定できます。

## オプション

### **-R, --recursive**

指定したディレクトリ内のすべてのファイルとサブディレクトリに対して再帰的に権限を変更します。

```console
$ chmod -R 755 projects/
# projects/ディレクトリとその中のすべてのファイルとディレクトリに755の権限を設定する
```

### **-v, --verbose**

処理されるファイルごとに診断メッセージを表示します。

```console
$ chmod -v 644 file.txt
mode of 'file.txt' changed from 0755 (rwxr-xr-x) to 0644 (rw-r--r--)
```

### **-c, --changes**

`-v`と似ていますが、実際に変更があった場合のみ出力します。

```console
$ chmod -c 644 file.txt
mode of 'file.txt' changed from 0755 (rwxr-xr-x) to 0644 (rw-r--r--)
```

## 使用例

### 数値モードでの権限変更

```console
$ chmod 755 script.sh
$ ls -l script.sh
-rwxr-xr-x  1 user  staff  1024 Apr 30 15:30 script.sh
```

数値モードでは、最初の数字が所有者、2番目がグループ、3番目がその他のユーザーの権限を表します。各数字は、読み取り(4)、書き込み(2)、実行(1)の合計値です。

### シンボリックモードでの権限変更

```console
$ chmod u+x script.sh
$ ls -l script.sh
-rwxr--r--  1 user  staff  1024 Apr 30 15:30 script.sh
```

シンボリックモードでは、`u`（所有者）、`g`（グループ）、`o`（その他）、`a`（すべて）に対して、`+`（追加）、`-`（削除）、`=`（設定）の操作を行います。

### ディレクトリとその内容に再帰的に権限を設定

```console
$ chmod -R go-w documents/
# documents/ディレクトリとその中のすべてのファイルからグループとその他のユーザーの書き込み権限を削除
```

## ヒント:

### 実行可能スクリプトの作成

新しく作成したシェルスクリプトを実行可能にするには、`chmod +x script.sh`を使用します。これにより、`./script.sh`として直接実行できるようになります。

### ディレクトリの権限設定

ディレクトリには通常、所有者に対して`rwx`（7）、グループとその他に対して`r-x`（5）の権限を設定します（`chmod 755 directory/`）。これにより、所有者はファイルの作成や削除ができ、他のユーザーはディレクトリ内を閲覧できます。

### セキュリティに関する注意点

重要なファイルには適切な権限を設定しましょう。例えば、秘密鍵ファイルには`chmod 600 ~/.ssh/id_rsa`（所有者のみ読み書き可能）を設定するのが一般的です。

## よくある質問

#### Q1. 数値モードの755や644は何を意味していますか？
A. 数値モードでは、各桁が所有者、グループ、その他のユーザーの権限を表します。各桁は読み取り(4)、書き込み(2)、実行(1)の合計値です。755は所有者に読み書き実行(7)、グループとその他に読み取りと実行(5)を与えます。644は所有者に読み書き(6)、グループとその他に読み取り(4)を与えます。

#### Q2. ファイルを所有者だけが読み書きできるようにするには？
A. `chmod 600 file.txt`を使用します。これにより、所有者のみがファイルを読み書きでき、他のユーザーはアクセスできなくなります。

#### Q3. 「Permission denied」エラーが出た場合はどうすればよいですか？
A. そのファイルの所有者であるか、または`sudo`権限を持っている必要があります。所有者の場合は`chmod`コマンドを使用し、そうでない場合は`sudo chmod`を使用してください。

#### Q4. シンボリックモードと数値モードの違いは何ですか？
A. シンボリックモード（`u+x`など）は現在の権限を基に変更を加えるのに対し、数値モード（`755`など）は権限を完全に上書きします。シンボリックモードは特定の権限だけを変更したい場合に便利です。

## macOSでの注意点

macOSでは、一部のシステムディレクトリに対する権限変更が制限されている場合があります。System Integrity Protection (SIP)が有効な場合、システムファイルの権限を変更するには特別な手順が必要です。また、外部ドライブのファイルシステム（FAT32やexFATなど）では、Unixの権限システムが完全にサポートされていない場合があります。

## 参考資料

https://www.gnu.org/software/coreutils/manual/html_node/chmod-invocation.html

## 改訂履歴

- 2025/04/30 初版作成