# set コマンド

シェル変数の設定や表示、シェルの動作を制御するためのコマンドです。

## 概要

`set` コマンドはシェル環境の変数を設定・表示したり、シェルの動作オプションを変更したりするために使用します。Bash、Zsh、shなど多くのシェルで利用可能で、引数なしで実行すると現在設定されているすべての環境変数とシェル関数を表示します。また、様々なオプションを使ってシェルの挙動を制御することができます。

## オプション

### **-e**

エラーが発生した時点でスクリプトの実行を中止します。

```console
$ set -e
$ command_that_fails
[エラーが発生するとスクリプトはここで終了する]
```

### **-x**

実行されるコマンドを実行前に表示します（デバッグに便利）。

```console
$ set -x
$ echo "Hello"
+ echo "Hello"
Hello
```

### **-u**

未定義の変数を参照した場合にエラーを発生させます。

```console
$ set -u
$ echo $UNDEFINED_VARIABLE
bash: UNDEFINED_VARIABLE: unbound variable
```

### **-o**

特定のシェルオプションを有効または無効にします。

```console
$ set -o noclobber  # リダイレクトによる既存ファイルの上書きを防止
$ set +o noclobber  # noclobberオプションを無効化
```

## 使用例

### 現在の環境変数とシェル関数を表示

```console
$ set
BASH=/bin/bash
BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:...
...
[多数の変数と関数が表示される]
```

### スクリプトでの安全なオプション設定

```console
$ cat safe_script.sh
#!/bin/bash
set -euo pipefail

# エラーが発生すると即座に終了
# 未定義変数を使用するとエラー
# パイプラインの最後のコマンド以外のエラーも検出

echo "安全なスクリプトの実行"
```

### 位置パラメータの設定

```console
$ set -- arg1 arg2 arg3
$ echo $1 $2 $3
arg1 arg2 arg3
```

## ヒント:

### シェルスクリプトの堅牢性向上

`set -euo pipefail` はシェルスクリプトの堅牢性を高めるための一般的な組み合わせです。エラーで即座に停止し、未定義変数を使用するとエラーになり、パイプラインの途中でのエラーも検出します。

### デバッグモード

`set -x` はスクリプトのデバッグに非常に役立ちます。各コマンドが実行される前に表示されるため、問題の特定が容易になります。

### 位置パラメータのリセット

`set --` を使うと、シェルの位置パラメータ（$1, $2, ...）を新しい値に設定できます。これはスクリプト内で引数を処理する際に便利です。

## よくある質問

#### Q1. `set` と `export` の違いは何ですか？
A. `set` はシェル変数の設定や表示、シェルの動作オプションの変更に使用します。一方、`export` はシェル変数を環境変数として子プロセスに引き継ぐために使用します。

#### Q2. `set -e` と `set -x` を同時に使うことはできますか？
A. はい、`set -ex` のように組み合わせて使用できます。これにより、コマンドの実行前表示（デバッグ）とエラー時の即時終了の両方が有効になります。

#### Q3. `set` コマンドの変更は永続的ですか？
A. いいえ、`set` コマンドによる変更は現在のシェルセッションまたはスクリプト実行中のみ有効です。永続的な設定を行うには、`.bashrc` や `.zshrc` などの設定ファイルに記述する必要があります。

#### Q4. `set +e` は何をしますか？
A. `set +e` は `-e` オプション（エラー時即時終了）を無効にします。`set` コマンドでは、`-` でオプションを有効に、`+` でオプションを無効にします。

## macOSでの注意点

macOSのデフォルトシェルはZsh（以前はBash）ですが、GNU版のBashとは一部の動作が異なる場合があります。特に古いバージョンのBashでは、一部のオプション（例：`pipefail`）が利用できない場合があります。必要に応じて `brew install bash` などでより新しいバージョンをインストールすることを検討してください。

## 参考文献

https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html

## 改訂履歴

- 2025/04/30 初版作成