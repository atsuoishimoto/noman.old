# expr コマンド

式を評価し、その結果を標準出力に表示します。

## 概要

`expr` コマンドは、与えられた式（数値計算や文字列操作など）を評価し、その結果を出力します。基本的な算術演算、文字列操作、論理比較などを行うことができます。シェルスクリプト内で計算や条件判定に使用されることが多いです。

## オプション

`expr` コマンド自体にはオプションがほとんどありませんが、様々な演算子を使用して式を構築します。

### **算術演算子**

基本的な数値計算を行います（`+`, `-`, `*`, `/`, `%`）。

```console
$ expr 5 + 3
8
$ expr 10 - 4
6
$ expr 3 \* 4    # 乗算には \ でエスケープが必要
12
$ expr 20 / 4
5
$ expr 10 % 3    # 剰余（余り）
1
```

### **比較演算子**

値の比較を行います（`=`, `!=`, `>`, `>=`, `<`, `<=`）。

```console
$ expr 5 = 5     # 等しい場合は 1、そうでなければ 0
1
$ expr 5 != 5    # 等しくない場合は 1、そうでなければ 0
0
$ expr 10 \> 5   # 大なり記号はエスケープが必要
1
$ expr 3 \< 5    # 小なり記号もエスケープが必要
1
```

### **文字列操作**

文字列の長さや部分文字列の抽出などを行います。

```console
$ expr length "Hello"    # 文字列の長さを取得
5
$ expr substr "Hello World" 7 5    # 部分文字列の抽出（開始位置7から5文字）
World
$ expr index "Hello" "l"    # 文字が最初に現れる位置
3
```

## 使用例

### 変数の増分

```console
$ count=1
$ count=`expr $count + 1`
$ echo $count
2
```

### 文字列の長さを取得

```console
$ str="Hello, World!"
$ len=`expr length "$str"`
$ echo $len
13
```

### 条件分岐での使用

```console
$ if [ `expr 10 % 2` = 0 ]; then echo "偶数である"; else echo "奇数である"; fi
偶数である
```

## ヒント:

### シェルの特殊文字をエスケープする

`*`, `(`, `)`, `<`, `>` などの文字はシェルで特別な意味を持つため、`expr` で使用する際は `\` でエスケープする必要があります。

```console
$ expr 3 \* 4    # * はエスケープしないとファイル名展開として解釈される
12
```

### 現代的な代替手段

最近のシェルでは、`$(( ))` 構文や `$[ ]` 構文を使用した算術展開の方が簡潔で高速です。

```console
$ echo $((3 * 4))    # bash や zsh での算術展開
12
```

### 戻り値に注意

`expr` は評価結果を標準出力に出力するだけでなく、結果が 0 または空文字列の場合は終了ステータス 1 を返します。それ以外は 0 を返します。

## よくある質問

#### Q1. `expr` と `$(( ))` の違いは何ですか？
A. `expr` は独立したコマンドであり、すべてのUNIX系システムで利用可能です。一方、`$(( ))` はシェルの機能（算術展開）で、bashやzshなどの現代的なシェルでのみ使用できますが、より高速で使いやすいです。

#### Q2. 文字列が数値かどうかを確認するにはどうすればよいですか？
A. `expr "$string" + 0` を使用すると、文字列が数値でない場合はエラーが発生します。これを利用して判定できます。

#### Q3. `expr` で小数点の計算はできますか？
A. いいえ、`expr` は整数計算のみをサポートしています。小数点計算には `bc` や `awk` などの他のコマンドを使用してください。

## macOSでの注意点

macOSの `expr` は BSD 由来であり、GNU 版と若干の違いがあります。特に複雑な式を扱う場合は、エスケープの扱いや一部の機能に違いがある可能性があるため注意が必要です。

## 参照

https://pubs.opengroup.org/onlinepubs/9699919799/utilities/expr.html

## 改訂履歴

- 2025/04/30 初版作成